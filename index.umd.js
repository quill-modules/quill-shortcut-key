!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("quill")):"function"==typeof define&&define.amd?define(["exports","quill"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).QuillShortcutKey={},e.Quill)}(this,(function(e,t){"use strict";const n=(e,t)=>{const n=`${e}-`;return{b:()=>`${n}${t}`,be:e=>e?`${n}${t}__${e}`:"",bm:e=>e?`${n}${t}--${e}`:"",bem:(e,i)=>e&&i?`${n}${t}__${e}--${i}`:"",ns:e=>e?`${n}${e}`:"",bs:e=>e?`${n}${t}-${e}`:"",cv:e=>e?`--${n}${e}`:"",is:e=>`is-${e}`}},i=n("qsf","menu"),s=e=>{const t=document.createElement("div");t.classList.add(i.b());for(const[n,o]of e.entries()){const{type:e,classes:r=[]}=o,l=document.createElement("div");if(l.classList.add(i.be("item"),...r),"break"===e)l.classList.add(i.is("break"));else{if("item"!==e)continue;{const{icon:e,text:t,content:r,children:a=[],onHover:c,onClick:d,onClose:h,onOpen:u}=o;if(!e&&!t&&!r)continue;const m={data:o,index:n,item:l};if(r)l.appendChild(r());else{if(e){const t=document.createElement("span");t.classList.add(i.be("icon")),t.innerHTML=e,l.appendChild(t)}if(t){const e=document.createElement("span");e.textContent=t,l.appendChild(e)}}if(a.length>0){l.dataset.hasChildren="true";const e=document.createElement("span");e.classList.add(i.be("icon"),i.is("arrow")),e.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"></path></svg>',l.appendChild(e);const t=s(a);let o;t.classList.add(i.is("transparent"));const r=()=>{t.remove(),h?.(m)},c=()=>{if(l.contains(t))return;o&&(clearTimeout(o),o=void 0),l.classList.add(i.is("active")),t.dataset.parent=n.toString(),t.removeEventListener("transitionend",r);const e=l.getBoundingClientRect();Object.assign(t.style,{position:"fixed",top:`${e.top}px`,left:`${e.right}px`}),l.appendChild(t),requestAnimationFrame((()=>{t.classList.remove(i.is("transparent"));const n=t.getBoundingClientRect();n.right>window.innerWidth&&Object.assign(t.style,{left:e.left-n.width+"px"}),n.bottom>window.innerHeight&&Object.assign(t.style,{top:e.bottom-n.height+"px"}),u?.(m)}))},d=()=>{o&&(clearTimeout(o),o=void 0),o=setTimeout((()=>{t.addEventListener("transitionend",r,{once:!0}),t.classList.add(i.is("transparent"))}),150)};l.addEventListener("click",c),l.addEventListener("mouseenter",c),l.addEventListener("mouseleave",d)}c&&l.addEventListener("mouseenter",(()=>c(m))),d&&l.addEventListener("click",(()=>d(m)))}}t.appendChild(l)}return t},o=t.import("ui/icons");o.header[1]='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h8m-8 6V6m8 12V6m5 6l3-2v8"/></svg>',o.header[2]='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h8m-8 6V6m8 12V6m9 12h-4c0-4 4-3 4-6c0-1.5-2-2.5-4-1"/></svg>',o.header[3]='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h8m-8 6V6m8 12V6m5.5 4.5c1.7-1 3.5 0 3.5 1.5a2 2 0 0 1-2 2m-2 3.5c2 1.5 4 .3 4-1.5a2 2 0 0 0-2-2"/></svg>',o.header[4]='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18V6m5 4v3a1 1 0 0 0 1 1h3m0-4v8M4 12h8m-8 6V6"/></svg>',o.header[5]='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h8m-8 6V6m8 12V6m5 7v-3h4m-4 7.7c.4.2.8.3 1.3.3c1.5 0 2.7-1.1 2.7-2.5S19.8 13 18.3 13H17"/></svg>',o.header[6]='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M4 12h8m-8 6V6m8 12V6"/><circle cx="19" cy="16" r="2"/><path d="M20 10c-2 2-3 3.5-3 6"/></g></svg>';const r={h1:"标题1",h2:"标题2",h3:"标题3",h4:"标题4",h5:"标题5",h6:"标题6",blockquote:"引用",codeblock:"代码块",code:"行内代码",link:"链接",image:"图片",video:"视频",formula:"公式",list:"列表",listBullet:"无序列表",listOrdered:"有序列表",listCheck:"任务列表"},l=[...new Array(6).fill(0).map(((e,n)=>({type:"item",name:`h${n+1}`,alias:["header",`head${n+1}`],icon:o.header[n+1],title:r[`h${n+1}`],onClick(e,i){e&&this.formatLine(e.index,0,"header",n+1,t.sources.USER)}}))),{type:"item",name:"bq",alias:["blockquote"],icon:o.blockquote,title:r.blockquote,descriptions:"插入引用格式",onClick(e,n){e&&this.formatLine(e.index,0,"blockquote",!0,t.sources.USER)}},{type:"item",name:"cb",alias:["code","codeblock"],icon:o["code-block"],title:r.codeblock,onClick(e,n){e&&this.formatLine(e.index,0,"code-block",!0,t.sources.USER)}},{type:"item",name:"lk",alias:["link"],icon:o.link,title:r.link,onClick(e,n){if(!e)return;const i=prompt("Enter link title");if(!i)return;const s=prompt("Enter link URL");s&&(this.insertText(e.index,i,t.sources.USER),this.formatText(e.index,e.length+i.length,"link",s,t.sources.USER),this.setSelection({index:e.index,length:e.index+i.length}))}},{type:"item",name:"img",alias:["image","pic","picture"],icon:o.image,title:r.image,onClick(e,n){if(!e)return;const i=prompt("Enter image");i&&this.insertEmbed(e.index,"image",i,t.sources.USER)}},{type:"item",name:"vd",alias:["video"],icon:o.video,title:r.video,onClick(e,n){if(!e)return;const i=prompt("Enter video");i&&this.insertEmbed(e.index,"video",i,t.sources.USER)}},{type:"item",name:"fm",alias:["formula"],icon:o.formula,title:r.formula,onClick(e,n){if(!e)return;const i=prompt("Enter formula");i&&this.insertEmbed(e.index,"formula",i,t.sources.USER)}},{type:"group",name:"list",alias:[],hideSearch:!0,icon:o.list.bullet,title:r.list,children:[{type:"item",name:"bl",alias:["list","bullet"],icon:o.list.bullet,title:r.listBullet,onClick(e,n){e&&this.formatLine(e.index,0,"list","bullet",t.sources.USER)}},{type:"item",name:"od",alias:["list","ordered"],icon:o.list.ordered,title:r.listOrdered,onClick(e,n){e&&this.formatLine(e.index,0,"list","ordered",t.sources.USER)}},{type:"item",name:"ck",alias:["list","check"],icon:o.list.check,title:r.listCheck,onClick(e,n){e&&this.formatLine(e.index,0,"list","unchecked",t.sources.USER)}}]}],a={clean:{key:"/",shortKey:!0,handler(e){this.quill.removeFormat(e.index,e.length,t.sources.USER)}},...(e=>{const n=Object.keys(e),i={};for(const s of n){const[n,o]=s.split(" "),r=void 0===o;i[s]={handler(e,i){this.quill.format(n,r?!i.format[n]:o,t.sources.USER)},...e[s]}}return i})({strike:{key:"d",shortKey:!0},"align ":{key:"l",altKey:!0},"align center":{key:"c",altKey:!0},"align right":{key:"r",altKey:!0},"align justify":{key:"j",altKey:!0},"indent +1":{key:"]",shortKey:!0},"indent -1":{key:"[",shortKey:!0},"script sub":{key:";",shortKey:!0},"script super":{key:"'",shortKey:!0},code:{key:"e",shortKey:!0},"direction rtl":{key:"r",shortKey:!0},"direction ":{key:"l",shortKey:!0}})};function c(e,t){const n=e.toLowerCase(),i=t.toLowerCase();return n===i?2:i.includes(n)?1:0}function d(e,t){const n=e.map((e=>{let n=c(t,e.name);if(e.alias)for(const i of e.alias)n=Math.max(n,c(t,i));return{item:e,score:n}})).filter((({score:e})=>e>=.5));return n.sort(((e,t)=>t.score-e.score)),n.map((({item:e})=>e))}const h=t.import("parchment");class u{quill;bem=n("qsf","menu");options;menuSorter;currentMenu;menuContainer;menuKeyboardControlsCleanup;currentRange={index:0,length:0};placeholderBem=n("qsf","placeholder");placeholderTip;constructor(e,n){this.quill=e,this.options=this.resolveOptions(n),this.currentMenu=this.options.menuItems,this.menuSorter=d.bind(this,this.getAllMenuItems()),this.placeholderTip=this.initPlaceholder(),this.placeholderUpdate(),this.quill.on(t.events.COMPOSITION_START,(()=>{this.placeholderHide()})),this.quill.on(t.events.COMPOSITION_END,(()=>{this.placeholderUpdate()})),this.quill.on(t.events.EDITOR_CHANGE,((e,n)=>{if(this.placeholderUpdate(),e===t.events.SELECTION_CHANGE){const e=n;if(e&&0===e.length){const[t,n]=this.quill.getLine(e.index);if(t){const i=e.index-n,s=i+t.length(),o=this.quill.getText(i,s),r=this.quill.getFormat(e.index,e.length),l=this.hasBlockFormat(r);if(o.startsWith("/")&&!l){const e=o.match(/^\/(.+)/);if(e){const t=this.menuSorter(e[1]);this.currentMenu=t}else this.currentMenu=this.options.menuItems;return void this.updateMenuList(t,r)}}}this.destroyMenuList()}else if(e===t.events.TEXT_CHANGE){const e=n;for(const t of e.ops)if(t.insert){if("/"!==t.insert)break;this.generateMenuList()}}}))}resolveOptions(e){return Object.assign({placeholder:"Input / recall menu",menuItems:[],menuKeyboardControls:()=>!1},e)}getAllMenuItems(){const e=[];for(const t of this.options.menuItems)t.hideSearch||e.push(t),"group"===t.type&&e.push(...t.children.filter((e=>!e.hideSearch)));return e}hasBlockFormat(e){return Object.keys(e).some((e=>this.quill.scroll.registry.query(e,h.Scope.BLOCK_BLOT)))}initPlaceholder(){const e=this.quill.addContainer(this.placeholderBem.b());return e.dataset.placeholder=this.options.placeholder,e}placeholderUpdate(){const e=this.quill.getSelection();if(e&&(this.currentRange=e),0===this.currentRange.length){const[e]=this.quill.getLine(this.currentRange.index),t=this.quill.getFormat(this.currentRange.index),n=this.hasBlockFormat(t);if(e&&e.length()<=1&&!n){const e=this.quill.getBounds(this.currentRange);if(e){this.placeholderTip.classList.remove(this.placeholderBem.is("hidden")),this.placeholderTip.classList.remove(this.placeholderBem.is("right"));const n={left:`${e.left}px`,top:`${e.top}px`};"right"===t.align&&(this.placeholderTip.classList.add(this.placeholderBem.is("right")),n.left=e.right-1+"px"),Object.assign(this.placeholderTip.style,n)}return}}this.placeholderHide()}placeholderHide(){this.placeholderTip.classList.add(this.placeholderBem.is("hidden"))}generateMenuItem(e,t){return{...t,type:"item",children:(t.children||[]).map((t=>this.generateMenuItem(e,t))),content:()=>{if(t.content)return t.content();{const e=document.createElement("div");if(e.classList.add(this.bem.be("item-container")),t.icon){const n=document.createElement("div");n.classList.add(this.bem.be("item-icon"));const i=document.createElement("div");i.classList.add(this.bem.be("icon")),i.innerHTML=t.icon,n.appendChild(i),e.appendChild(n)}const n=document.createElement("div");n.classList.add(this.bem.be("item-content"));const i=document.createElement("div");i.classList.add(this.bem.be("item-title"));const s=document.createElement("span");if(s.textContent=t.title,i.appendChild(s),"item"===t.type){const e=document.createElement("span");e.classList.add(this.bem.be("item-hint")),e.textContent=`/${t.name}`,i.appendChild(e)}if(n.appendChild(i),t.descriptions){const e=document.createElement("div");e.classList.add(this.bem.be("item-descriptions")),e.textContent=t.descriptions,n.appendChild(e)}return e.appendChild(n),e}},onClose:e=>{t.onCloseSub&&t.onCloseSub.call(this.quill,e)},onOpen:e=>{t.onOpenSub&&t.onOpenSub.call(this.quill,e)},onClick:n=>{if("item"===t.type&&(e.domNode.innerHTML="",this.destroyMenuList()),t.onClick){const e=this.quill.getSelection();t.onClick.call(this.quill,e,n)}}}}generateMenuList(){this.menuContainer||(this.menuContainer=document.createElement("div"),this.menuContainer.classList.add(this.bem.be("container")),this.quill.root.addEventListener("click",this.destroyMenuList),this.quill.container.appendChild(this.menuContainer))}updateMenuList(e,t){if(!this.menuContainer)return;this.menuContainer.innerHTML="";const n=s(this.currentMenu.map((t=>this.generateMenuItem(e,t))));this.menuKeyboardControlsCleanup&&this.menuKeyboardControlsCleanup(),this.menuKeyboardControlsCleanup=this.setupMenuKeyboardControls({wrapper:n,target:this.quill.root,menuControl:this.options.menuKeyboardControls});const i=this.quill.root.getBoundingClientRect(),o=e.domNode.getBoundingClientRect(),r=o.left-i.left+("right"===t.align?o.width:0),l=o.bottom-i.top;Object.assign(this.menuContainer.style,{left:`${r}px`,top:`${l}px`}),this.menuContainer.appendChild(n),requestAnimationFrame((()=>{if(!this.menuContainer)return;const e=this.menuContainer.getBoundingClientRect();window.innerWidth<e.right&&(this.menuContainer.style.left=r-e.width+"px"),window.innerHeight<e.bottom&&(this.menuContainer.style.top=l-o.height-e.height+"px")}))}destroyMenuList=()=>{this.quill.root.removeEventListener("click",this.destroyMenuList),this.menuKeyboardControlsCleanup&&this.menuKeyboardControlsCleanup(),this.menuContainer&&(this.menuContainer.remove(),this.menuContainer=void 0)};setupMenuKeyboardControls({wrapper:e,target:t,menuControl:n}){let i=e,s=null,o=-1;const r=e=>{const t=Array.from(i.querySelectorAll(`.${this.bem.be("item")}`));for(const[n,s]of t.entries())if(n===e){s.classList.add(this.bem.is("selected"));const e=i.getBoundingClientRect(),t=s.getBoundingClientRect(),n=t.bottom>e.bottom,o=t.top<e.top;n?i.scrollTop=s.offsetTop-i.clientHeight+t.height:o&&(i.scrollTop=s.offsetTop)}else s.classList.remove(this.bem.is("selected"));o=e},l=function(e,t){let n=null,i=[],s=null,o=0;return function(...r){const l=Date.now(),a=t-(l-o);i=r,s=this,a<=0||a>t?(n&&(clearTimeout(n),n=null),o=l,e.apply(s,i)):n||(n=setTimeout((()=>{o=Date.now(),n=null,e.apply(s,i)}),a))}}((e=>{const t=i.querySelectorAll(`:scope > .${this.bem.be("item")}`);if((0===t.length&&"Enter"===e.key||"Escape"===e.key)&&(e.preventDefault(),this.destroyMenuList()),0===t.length)return;if(!n(e,{currentMenu:i,selectedIndex:o}))switch(e.key){case"ArrowUp":e.preventDefault(),-1===o&&(o=0),r((o-1+t.length)%t.length);break;case"ArrowDown":e.preventDefault(),r((o+1)%t.length);break;case"ArrowRight":{e.preventDefault();const n=t[o];if(!n)return;if("true"===n.dataset.hasChildren){n.click();const e=n.querySelector(`.${this.bem.b()}`);e&&(s=i,i=e,r(0))}break}case"ArrowLeft":if(e.preventDefault(),s){const e=Number.parseInt(i.dataset.parent||"0",10);i=s,s=null,o=e,r(o);const t=Array.from(i.querySelectorAll(`.${this.bem.be("item")}`))[o];if(!t)return;t.dispatchEvent(new MouseEvent("mouseleave"))}break;case"Enter":{e.preventDefault();const n=t[Math.max(0,o)];if(n&&(n.click(),"true"===n.dataset.hasChildren)){const e=n.querySelector(`.${this.bem.b()}`);e&&(s=i,i=e,r(0))}break}}}),100),a=e=>{new Set(["ArrowUp","ArrowDown","ArrowRight","ArrowLeft","Enter","Escape"]).has(e.key)&&e.preventDefault(),l(e)};return t.addEventListener("keydown",a,!0),()=>{t.removeEventListener("keydown",a,!0)}}}e.QuillShortcutKey=u,e.default=u,e.defaultMenuItems=l,e.defaultShortKey=a,e.generateTableUpShortKeyMenu=function(e){const n=e({row:8,col:8,customBtn:!1}),i=()=>{const{row:e,col:t}=n.dataset;for(const e of Array.from(n.querySelectorAll(".active")))e.classList.remove("active");if(!e||!t)return;const i=Array.from(n.querySelectorAll(".table-up-select-box__item"));for(let n=0;n<i.length;n++){const{row:s,col:o}=i[n].dataset;if(s>e&&o>t)return;s<=e&&o<=t?i[n].classList.add("active"):i[n].classList.remove("active")}};return{tableUpKeyboardControl:(e,{currentMenu:t})=>{if(!t.contains(n))return!1;let s=Number(n.dataset.row),o=Number(n.dataset.col);switch(e.key){case"ArrowUp":s-=1;break;case"ArrowDown":s+=1;break;case"ArrowRight":o+=1;break;case"ArrowLeft":o-=1;break;default:return!1}return!(s<=0||o<=0)&&(s=Math.min(s,8),o=Math.min(o,8),n.dataset.row=String(s),n.dataset.col=String(o),i(),e.preventDefault(),!0)},tableUpConfig:{type:"group",name:"table",alias:[],title:"表格",icon:t.import("ui/icons").table,onOpenSub(e){const t=e.item.querySelector(".qsf-menu");t&&(t.style.width="auto"),n.dataset.row="1",n.dataset.col="1",i()},children:[{type:"item",name:"table",alias:[],classes:["no-selected-style"],hideSearch:!0,content:()=>n,onClick(){const{row:e,col:t}=n.dataset;if(!e||!t)return;this.getModule("table-up").insertTable(Number(e),Number(t))}}]}}},e.searchAndSort=d,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=index.umd.js.map
