(function(e,t){typeof exports==`object`&&typeof module<`u`?t(exports,require(`quill`)):typeof define==`function`&&define.amd?define([`exports`,`quill`],t):(e=typeof globalThis<`u`?globalThis:e||self,t(e.QuillShortcutKey={},e.Quill))})(this,function(e,t){Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:`Module`}});var n=Object.create,r=Object.defineProperty,i=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,o=Object.getPrototypeOf,s=Object.prototype.hasOwnProperty,c=(e,t,n,o)=>{if(t&&typeof t==`object`||typeof t==`function`)for(var c=a(t),l=0,u=c.length,d;l<u;l++)d=c[l],!s.call(e,d)&&d!==n&&r(e,d,{get:(e=>t[e]).bind(null,d),enumerable:!(o=i(t,d))||o.enumerable});return e};t=((e,t,i)=>(i=e==null?{}:n(o(e)),c(t||!e||!e.__esModule?r(i,`default`,{value:e,enumerable:!0}):i,e)))(t);let l=(e,t)=>{let n=e?`${e}-`:``;return{b:()=>`${n}${t}`,be:e=>e?`${n}${t}__${e}`:``,bm:e=>e?`${n}${t}--${e}`:``,bem:(e,r)=>e&&r?`${n}${t}__${e}--${r}`:``,ns:e=>e?`${n}${e}`:``,bs:e=>e?`${n}${t}-${e}`:``,cv:e=>e?`--${n}${e}`:``,is:e=>`is-${e}`}},u=l(`qsf`,`menu`),d=e=>{let t=document.createElement(`div`);t.classList.add(u.b());for(let[n,r]of e.entries()){let{type:e,classes:i=[]}=r,a=document.createElement(`div`);if(a.classList.add(u.be(`item`),...i),e===`break`)a.classList.add(u.is(`break`));else if(e===`item`){let{icon:e,text:t,content:i,children:o=[],onHover:s,onClick:c,onClose:l,onOpen:f}=r;if(!e&&!t&&!i)continue;let p={data:r,index:n,item:a};if(i)a.appendChild(i());else{if(e){let t=document.createElement(`span`);t.classList.add(u.be(`icon`)),t.innerHTML=e,a.appendChild(t)}if(t){let e=document.createElement(`span`);e.textContent=t,a.appendChild(e)}}if(o.length>0){a.dataset.hasChildren=`true`;let e=document.createElement(`span`);e.classList.add(u.be(`icon`),u.is(`arrow`)),e.innerHTML=`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"></path></svg>`,a.appendChild(e);let t=d(o);t.classList.add(u.is(`transparent`));let r,i=()=>{t.remove(),l==null||l(p)},s=()=>{if(a.contains(t))return;r&&(clearTimeout(r),r=void 0),a.classList.add(u.is(`active`)),t.dataset.parent=n.toString(),t.removeEventListener(`transitionend`,i);let e=a.getBoundingClientRect();Object.assign(t.style,{position:`fixed`,top:`${e.top}px`,left:`${e.right}px`}),a.appendChild(t),requestAnimationFrame(()=>{t.classList.remove(u.is(`transparent`));let n=t.getBoundingClientRect();n.right>window.innerWidth&&Object.assign(t.style,{left:`${e.left-n.width}px`}),n.bottom>window.innerHeight&&Object.assign(t.style,{top:`${e.bottom-n.height}px`}),f==null||f(p)})};a.addEventListener(`click`,s),a.addEventListener(`mouseenter`,s),a.addEventListener(`mouseleave`,()=>{r&&(clearTimeout(r),r=void 0),r=setTimeout(()=>{t.addEventListener(`transitionend`,i,{once:!0}),t.classList.add(u.is(`transparent`))},150)})}s&&a.addEventListener(`mouseenter`,()=>s(p)),c&&a.addEventListener(`click`,()=>c(p))}else continue;t.appendChild(a)}return t},f=e=>e===void 0,p=e=>typeof e==`string`;function m(e){"@babel/helpers - typeof";return m=typeof Symbol==`function`&&typeof Symbol.iterator==`symbol`?function(e){return typeof e}:function(e){return e&&typeof Symbol==`function`&&e.constructor===Symbol&&e!==Symbol.prototype?`symbol`:typeof e},m(e)}function h(e,t){if(m(e)!=`object`||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||`default`);if(m(r)!=`object`)return r;throw TypeError(`@@toPrimitive must return a primitive value.`)}return(t===`string`?String:Number)(e)}function g(e){var t=h(e,`string`);return m(t)==`symbol`?t:t+``}function _(e,t,n){return(t=g(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]==null?{}:arguments[t];t%2?v(Object(n),!0).forEach(function(t){_(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let b=t.default.import(`ui/icons`);b.header[1]=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h8m-8 6V6m8 12V6m5 6l3-2v8"/></svg>`,b.header[2]=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h8m-8 6V6m8 12V6m9 12h-4c0-4 4-3 4-6c0-1.5-2-2.5-4-1"/></svg>`,b.header[3]=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h8m-8 6V6m8 12V6m5.5 4.5c1.7-1 3.5 0 3.5 1.5a2 2 0 0 1-2 2m-2 3.5c2 1.5 4 .3 4-1.5a2 2 0 0 0-2-2"/></svg>`,b.header[4]=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18V6m5 4v3a1 1 0 0 0 1 1h3m0-4v8M4 12h8m-8 6V6"/></svg>`,b.header[5]=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h8m-8 6V6m8 12V6m5 7v-3h4m-4 7.7c.4.2.8.3 1.3.3c1.5 0 2.7-1.1 2.7-2.5S19.8 13 18.3 13H17"/></svg>`,b.header[6]=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M4 12h8m-8 6V6m8 12V6"/><circle cx="19" cy="16" r="2"/><path d="M20 10c-2 2-3 3.5-3 6"/></g></svg>`;let x={h1:`标题1`,h2:`标题2`,h3:`标题3`,h4:`标题4`,h5:`标题5`,h6:`标题6`,blockquote:`引用`,codeblock:`代码块`,code:`行内代码`,link:`链接`,image:`图片`,video:`视频`,formula:`公式`,list:`列表`,listBullet:`无序列表`,listOrdered:`有序列表`,listCheck:`任务列表`},S={blockquote:`插入引用格式`},C=[...[,,,,,,].fill(0).map((e,n)=>({type:`item`,name:`h${n+1}`,alias:[`header`,`head${n+1}`],icon:b.header[n+1],title:x[`h${n+1}`],onClick(e,r){e&&this.formatLine(e.index,0,`header`,n+1,t.default.sources.USER)}})),{type:`item`,name:`bq`,alias:[`blockquote`],icon:b.blockquote,title:x.blockquote,descriptions:S.blockquote,onClick(e,n){e&&this.formatLine(e.index,0,`blockquote`,!0,t.default.sources.USER)}},{type:`item`,name:`cb`,alias:[`code`,`codeblock`],icon:b[`code-block`],title:x.codeblock,onClick(e,n){e&&this.formatLine(e.index,0,`code-block`,!0,t.default.sources.USER)}},{type:`item`,name:`lk`,alias:[`link`],icon:b.link,title:x.link,onClick(e,n){if(!e)return;let r=prompt(`Enter link title`);if(!r)return;let i=prompt(`Enter link URL`);i&&(this.insertText(e.index,r,t.default.sources.USER),this.formatText(e.index,e.length+r.length,`link`,i,t.default.sources.USER),this.setSelection({index:e.index,length:e.index+r.length}))}},{type:`item`,name:`img`,alias:[`image`,`pic`,`picture`],icon:b.image,title:x.image,onClick(e,n){if(!e)return;let r=prompt(`Enter image`);r&&this.insertEmbed(e.index,`image`,r,t.default.sources.USER)}},{type:`item`,name:`vd`,alias:[`video`],icon:b.video,title:x.video,onClick(e,n){if(!e)return;let r=prompt(`Enter video`);r&&this.insertEmbed(e.index,`video`,r,t.default.sources.USER)}},{type:`item`,name:`fm`,alias:[`formula`],icon:b.formula,title:x.formula,onClick(e,n){if(!e)return;let r=prompt(`Enter formula`);r&&this.insertEmbed(e.index,`formula`,r,t.default.sources.USER)}},{type:`group`,name:`list`,alias:[],hideSearch:!0,icon:b.list.bullet,title:x.list,children:[{type:`item`,name:`bl`,alias:[`list`,`bullet`],icon:b.list.bullet,title:x.listBullet,onClick(e,n){e&&this.formatLine(e.index,0,`list`,`bullet`,t.default.sources.USER)}},{type:`item`,name:`od`,alias:[`list`,`ordered`],icon:b.list.ordered,title:x.listOrdered,onClick(e,n){e&&this.formatLine(e.index,0,`list`,`ordered`,t.default.sources.USER)}},{type:`item`,name:`ck`,alias:[`list`,`check`],icon:b.list.check,title:x.listCheck,onClick(e,n){e&&this.formatLine(e.index,0,`list`,`unchecked`,t.default.sources.USER)}}]}],w=y({clean:{key:`/`,shortKey:!0,handler(e){this.quill.removeFormat(e.index,e.length,t.default.sources.USER)}}},(e=>{let n=Object.keys(e),r={};for(let i of n){let[n,a]=i.split(` `),o=f(a);r[i]=y({handler(e,r){this.quill.format(n,o?!r.format[n]:a,t.default.sources.USER)}},e[i])}return r})({strike:{key:`d`,shortKey:!0},"align ":{key:`l`,altKey:!0},"align center":{key:`c`,altKey:!0},"align right":{key:`r`,altKey:!0},"align justify":{key:`j`,altKey:!0},"indent +1":{key:`]`,shortKey:!0},"indent -1":{key:`[`,shortKey:!0},"script sub":{key:`;`,shortKey:!0},"script super":{key:`'`,shortKey:!0},code:{key:`e`,shortKey:!0},"direction rtl":{key:`r`,shortKey:!0},"direction ":{key:`l`,shortKey:!0}}));function T(e){let n=e({row:8,col:8,customBtn:!1}),r=()=>{let{row:e,col:t}=n.dataset;for(let e of Array.from(n.querySelectorAll(`.active`)))e.classList.remove(`active`);if(!e||!t)return;let r=Array.from(n.querySelectorAll(`.table-up-select-box__item`));for(let n=0;n<r.length;n++){let{row:i,col:a}=r[n].dataset;if(i>e&&a>t)return;i<=e&&a<=t?r[n].classList.add(`active`):r[n].classList.remove(`active`)}};return{tableUpKeyboardControl:(e,{currentMenu:t})=>{if(!t.contains(n))return!1;let i=Number(n.dataset.row),a=Number(n.dataset.col);switch(e.key){case`ArrowUp`:--i;break;case`ArrowDown`:i+=1;break;case`ArrowRight`:a+=1;break;case`ArrowLeft`:--a;break;default:return!1}return i<=0||a<=0?!1:(i=Math.min(i,8),a=Math.min(a,8),n.dataset.row=String(i),n.dataset.col=String(a),r(),e.preventDefault(),!0)},tableUpConfig:{type:`group`,name:`table`,alias:[],title:`表格`,icon:t.default.import(`ui/icons`).table,onOpenSub(e){let t=e.item.querySelector(`.qsf-menu`);t&&(t.style.width=`auto`),n.dataset.row=`1`,n.dataset.col=`1`,r()},children:[{type:`item`,name:`table`,alias:[],classes:[`no-selected-style`],hideSearch:!0,content(){return n},onClick(){let{row:e,col:t}=n.dataset;!e||!t||this.getModule(`table-up`).insertTable(Number(e),Number(t))}}]}}}function E(e,t){let n=null,r=[],i=null,a=0;return function(...o){let s=Date.now(),c=t-(s-a);r=o,i=this,c<=0||c>t?(n&&(clearTimeout(n),n=null),a=s,e.apply(i,r)):n||(n=setTimeout(()=>{a=Date.now(),n=null,e.apply(i,r)},c))}}function D(e,t){let n=e.toLowerCase(),r=t.toLowerCase();return n===r?2:r.includes(n)?1:0}function O(e,t){let n=e.map(e=>{let n=D(t,e.name);if(e.alias)for(let r of e.alias)n=Math.max(n,D(t,r));return{item:e,score:n}}).filter(({score:e})=>e>=.5);return n.sort((e,t)=>t.score-e.score),n.map(({item:e})=>e)}let k=t.default.import(`parchment`);var A=class{constructor(e,n){this.quill=e,_(this,`bem`,l(`qsf`,`menu`)),_(this,`options`,void 0),_(this,`menuSorter`,void 0),_(this,`currentMenu`,void 0),_(this,`menuContainer`,void 0),_(this,`menuKeyboardControlsCleanup`,void 0),_(this,`currentRange`,{index:0,length:0}),_(this,`placeholderBem`,l(`qsf`,`placeholder`)),_(this,`placeholderTip`,void 0),_(this,`destroyMenuList`,()=>{this.quill.root.removeEventListener(`click`,this.destroyMenuList),this.menuKeyboardControlsCleanup&&this.menuKeyboardControlsCleanup(),this.menuContainer&&(this.menuContainer.remove(),this.menuContainer=void 0)}),this.options=this.resolveOptions(n),this.currentMenu=this.options.menuItems,this.menuSorter=O.bind(this,this.getAllMenuItems()),this.placeholderTip=this.initPlaceholder(),this.placeholderUpdate(),this.quill.on(t.default.events.COMPOSITION_START,()=>{this.placeholderHide()}),this.quill.on(t.default.events.COMPOSITION_END,()=>{this.placeholderUpdate()}),this.quill.on(t.default.events.EDITOR_CHANGE,(e,n)=>{if(this.placeholderUpdate(),e===t.default.events.SELECTION_CHANGE){let e=n;if(e&&e.length===0){let[t,n]=this.quill.getLine(e.index);if(t){let r=e.index-n,i=r+t.length(),a=this.quill.getText(r,i),o=this.quill.getFormat(e.index,e.length),s=this.hasBlockFormat(o);if(a.startsWith(`/`)&&!s){let e=a.match(/^\/(.+)/);e?this.currentMenu=this.menuSorter(e[1]):this.currentMenu=this.options.menuItems,this.updateMenuList(t,o);return}}}this.destroyMenuList()}else if(e===t.default.events.TEXT_CHANGE){let e=n;for(let t of e.ops)if(t.insert)if(t.insert===`/`)this.generateMenuList();else break}}),this.quill.root.addEventListener(`scroll`,()=>{this.placeholderUpdate()})}resolveOptions(e){return Object.assign({placeholder:`Input / recall menu`,menuItems:[],menuKeyboardControls:()=>!1},e)}getAllMenuItems(){let e=[];for(let t of this.options.menuItems)t.hideSearch||e.push(t),t.type===`group`&&e.push(...t.children.filter(e=>!e.hideSearch));return e}hasBlockFormat(e){return Object.keys(e).some(e=>this.quill.scroll.registry.query(e,k.Scope.BLOCK_BLOT))}initPlaceholder(){let e=this.quill.addContainer(this.placeholderBem.be(`wrapper`)),t=this.quill.addContainer(this.placeholderBem.b());return t.dataset.placeholder=this.options.placeholder,e.appendChild(t),t}placeholderUpdate(){let e=this.quill.getSelection();if(e&&(this.currentRange=e),this.currentRange.length===0){let[e]=this.quill.getLine(this.currentRange.index);if(e&&e.length()<=1){let t=this.quill.getContents(this.currentRange.index,e.length()||0).ops[0],n=this.hasBlockFormat(t.attributes||{}),r=!1;if(p(t.insert)||(r=this.hasBlockFormat(t.insert||{})),!n&&!r){let e=this.quill.getBounds(this.currentRange);if(e){this.placeholderTip.classList.remove(this.placeholderBem.is(`hidden`)),this.placeholderTip.classList.remove(this.placeholderBem.is(`right`));let n={left:`${e.left}px`,top:`${e.top}px`};t.attributes&&t.attributes.align===`right`&&(this.placeholderTip.classList.add(this.placeholderBem.is(`right`)),n.left=`${e.right-1}px`),Object.assign(this.placeholderTip.style,n)}return}}}this.placeholderHide()}placeholderHide(){this.placeholderTip.classList.add(this.placeholderBem.is(`hidden`))}generateMenuItem(e,t){return y(y({},t),{},{type:`item`,children:(t.children||[]).map(t=>this.generateMenuItem(e,t)),content:()=>{if(t.content)return t.content();{let e=document.createElement(`div`);if(e.classList.add(this.bem.be(`item-container`)),t.icon){let n=document.createElement(`div`);n.classList.add(this.bem.be(`item-icon`));let r=document.createElement(`div`);r.classList.add(this.bem.be(`icon`)),r.innerHTML=t.icon,n.appendChild(r),e.appendChild(n)}let n=document.createElement(`div`);n.classList.add(this.bem.be(`item-content`));let r=document.createElement(`div`);r.classList.add(this.bem.be(`item-title`));let i=document.createElement(`span`);if(i.textContent=t.title,r.appendChild(i),t.type===`item`){let e=document.createElement(`span`);e.classList.add(this.bem.be(`item-hint`)),e.textContent=`/${t.name}`,r.appendChild(e)}if(n.appendChild(r),t.descriptions){let e=document.createElement(`div`);e.classList.add(this.bem.be(`item-descriptions`)),e.textContent=t.descriptions,n.appendChild(e)}return e.appendChild(n),e}},onClose:e=>{t.onCloseSub&&t.onCloseSub.call(this.quill,e)},onOpen:e=>{t.onOpenSub&&t.onOpenSub.call(this.quill,e)},onClick:n=>{if(t.type===`item`&&(e.domNode.innerHTML=``,this.destroyMenuList()),t.onClick){let e=this.quill.getSelection();t.onClick.call(this.quill,e,n)}}})}generateMenuList(){this.menuContainer||(this.menuContainer=document.createElement(`div`),this.menuContainer.classList.add(this.bem.be(`container`)),this.quill.root.addEventListener(`click`,this.destroyMenuList),this.quill.container.appendChild(this.menuContainer))}updateMenuList(e,t){if(!this.menuContainer)return;this.menuContainer.innerHTML=``;let n=d(this.currentMenu.map(t=>this.generateMenuItem(e,t)));this.menuKeyboardControlsCleanup&&this.menuKeyboardControlsCleanup(),this.menuKeyboardControlsCleanup=this.setupMenuKeyboardControls({wrapper:n,target:this.quill.root,menuControl:this.options.menuKeyboardControls});let r=this.quill.root.getBoundingClientRect(),i=e.domNode.getBoundingClientRect(),a=i.left-r.left+(t.align===`right`?i.width:0),o=i.bottom-r.top;Object.assign(this.menuContainer.style,{left:`${a}px`,top:`${o}px`}),this.menuContainer.appendChild(n),requestAnimationFrame(()=>{if(!this.menuContainer)return;let e=this.menuContainer.getBoundingClientRect();window.innerWidth<e.right&&(this.menuContainer.style.left=`${a-e.width}px`),window.innerHeight<e.bottom&&(this.menuContainer.style.top=`${o-i.height-e.height}px`)})}setupMenuKeyboardControls({wrapper:e,target:t,menuControl:n}){let r=e,i=null,a=-1,o=e=>{let t=Array.from(r.querySelectorAll(`.${this.bem.be(`item`)}`));for(let[n,i]of t.entries())if(n===e){i.classList.add(this.bem.is(`selected`));let e=r.getBoundingClientRect(),t=i.getBoundingClientRect(),n=t.bottom>e.bottom,a=t.top<e.top;n?r.scrollTop=i.offsetTop-r.clientHeight+t.height:a&&(r.scrollTop=i.offsetTop)}else i.classList.remove(this.bem.is(`selected`));a=e},s=E(e=>{let t=r.querySelectorAll(`:scope > .${this.bem.be(`item`)}`);if((t.length===0&&e.key===`Enter`||e.key===`Escape`)&&(e.preventDefault(),this.destroyMenuList()),t.length!==0&&!n(e,{currentMenu:r,selectedIndex:a}))switch(e.key){case`ArrowUp`:e.preventDefault(),a===-1&&(a=0),o((a-1+t.length)%t.length);break;case`ArrowDown`:e.preventDefault(),o((a+1)%t.length);break;case`ArrowRight`:{e.preventDefault();let n=t[a];if(!n)return;if(n.dataset.hasChildren===`true`){n.click();let e=n.querySelector(`.${this.bem.b()}`);e&&(i=r,r=e,o(0))}break}case`ArrowLeft`:if(e.preventDefault(),i){let e=Number.parseInt(r.dataset.parent||`0`,10);r=i,i=null,a=e,o(a);let t=Array.from(r.querySelectorAll(`.${this.bem.be(`item`)}`))[a];if(!t)return;t.dispatchEvent(new MouseEvent(`mouseleave`))}break;case`Enter`:{e.preventDefault();let n=t[Math.max(0,a)];if(n&&(n.click(),n.dataset.hasChildren===`true`)){let e=n.querySelector(`.${this.bem.b()}`);e&&(i=r,r=e,o(0))}break}}},100),c=e=>{new Set([`ArrowUp`,`ArrowDown`,`ArrowRight`,`ArrowLeft`,`Enter`,`Escape`]).has(e.key)&&e.preventDefault(),s(e)};return t.addEventListener(`keydown`,c,!0),()=>{t.removeEventListener(`keydown`,c,!0)}}};e.QuillShortcutKey=A,e.default=A,e.defaultMenuItems=C,e.defaultShortKey=w,e.generateTableUpShortKeyMenu=T,e.searchAndSort=O});
//# sourceMappingURL=index.umd.js.map