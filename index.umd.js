(function(e,t){typeof exports==`object`&&typeof module<`u`?t(exports,require(`quill`)):typeof define==`function`&&define.amd?define([`exports`,`quill`],t):(e=typeof globalThis<`u`?globalThis:e||self,t(e.QuillShortcutKey={},e.Quill))})(this,function(e,t){Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:`Module`}});var n=Object.create,r=Object.defineProperty,i=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,o=Object.getPrototypeOf,s=Object.prototype.hasOwnProperty,c=(e,t,n,o)=>{if(t&&typeof t==`object`||typeof t==`function`)for(var c=a(t),l=0,u=c.length,d;l<u;l++)d=c[l],!s.call(e,d)&&d!==n&&r(e,d,{get:(e=>t[e]).bind(null,d),enumerable:!(o=i(t,d))||o.enumerable});return e};t=((e,t,i)=>(i=e==null?{}:n(o(e)),c(t||!e||!e.__esModule?r(i,`default`,{value:e,enumerable:!0}):i,e)))(t);function l(e,t){let n=e?`${e}-`:``;return{b:()=>`${n}${t}`,be:e=>e?`${n}${t}__${e}`:``,bm:e=>e?`${n}${t}--${e}`:``,bem:(e,r)=>e&&r?`${n}${t}__${e}--${r}`:``,ns:e=>e?`${n}${e}`:``,bs:e=>e?`${n}${t}-${e}`:``,cv:e=>e?`--${n}${e}`:``,is:e=>`is-${e}`}}let u=l(`qsf`,`menu`);function d(e){let t=document.createElement(`div`);t.classList.add(u.b());for(let[n,r]of e.entries()){let{type:e,classes:i=[]}=r,a=document.createElement(`div`);if(a.classList.add(u.be(`item`),...i),e===`break`)a.classList.add(u.is(`break`));else if(e===`item`){let{icon:e,text:t,content:i,children:o=[],onHover:s,onClick:c,onClose:l,onOpen:f}=r;if(!e&&!t&&!i)continue;let p={data:r,index:n,item:a};if(i)a.appendChild(i());else{if(e){let t=document.createElement(`span`);t.classList.add(u.be(`icon`)),t.innerHTML=e,a.appendChild(t)}if(t){let e=document.createElement(`span`);e.textContent=t,a.appendChild(e)}}if(o.length>0){a.dataset.hasChildren=`true`;let e=document.createElement(`span`);e.classList.add(u.be(`icon`),u.is(`arrow`)),e.innerHTML=`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"></path></svg>`,a.appendChild(e);let t=d(o);t.classList.add(u.is(`transparent`));let r,i=()=>{t.remove(),l==null||l(p)},s=()=>{if(a.contains(t))return;r&&(clearTimeout(r),r=void 0),a.classList.add(u.is(`active`)),t.dataset.parent=n.toString(),t.removeEventListener(`transitionend`,i);let e=a.getBoundingClientRect();Object.assign(t.style,{position:`fixed`,top:`${e.top}px`,left:`${e.right}px`}),a.appendChild(t),requestAnimationFrame(()=>{t.classList.remove(u.is(`transparent`));let n=t.getBoundingClientRect();n.right>window.innerWidth&&Object.assign(t.style,{left:`${e.left-n.width}px`}),n.bottom>window.innerHeight&&Object.assign(t.style,{top:`${e.bottom-n.height}px`}),f==null||f(p)})};a.addEventListener(`click`,s),a.addEventListener(`mouseenter`,s),a.addEventListener(`mouseleave`,()=>{r&&(clearTimeout(r),r=void 0),r=setTimeout(()=>{t.addEventListener(`transitionend`,i,{once:!0}),t.classList.add(u.is(`transparent`))},150)})}s&&a.addEventListener(`mouseenter`,()=>s(p)),c&&a.addEventListener(`click`,()=>c(p))}else continue;t.appendChild(a)}return t}let f=e=>e===void 0,p=e=>typeof e==`string`,m=e=>typeof e==`function`;function h(e){"@babel/helpers - typeof";return h=typeof Symbol==`function`&&typeof Symbol.iterator==`symbol`?function(e){return typeof e}:function(e){return e&&typeof Symbol==`function`&&e.constructor===Symbol&&e!==Symbol.prototype?`symbol`:typeof e},h(e)}function g(e,t){if(h(e)!=`object`||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||`default`);if(h(r)!=`object`)return r;throw TypeError(`@@toPrimitive must return a primitive value.`)}return(t===`string`?String:Number)(e)}function _(e){var t=g(e,`string`);return h(t)==`symbol`?t:t+``}function v(e,t,n){return(t=_(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]==null?{}:arguments[t];t%2?y(Object(n),!0).forEach(function(t){v(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let x=t.default.import(`ui/icons`);x.header[1]=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h8m-8 6V6m8 12V6m5 6l3-2v8"/></svg>`,x.header[2]=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h8m-8 6V6m8 12V6m9 12h-4c0-4 4-3 4-6c0-1.5-2-2.5-4-1"/></svg>`,x.header[3]=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h8m-8 6V6m8 12V6m5.5 4.5c1.7-1 3.5 0 3.5 1.5a2 2 0 0 1-2 2m-2 3.5c2 1.5 4 .3 4-1.5a2 2 0 0 0-2-2"/></svg>`,x.header[4]=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18V6m5 4v3a1 1 0 0 0 1 1h3m0-4v8M4 12h8m-8 6V6"/></svg>`,x.header[5]=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h8m-8 6V6m8 12V6m5 7v-3h4m-4 7.7c.4.2.8.3 1.3.3c1.5 0 2.7-1.1 2.7-2.5S19.8 13 18.3 13H17"/></svg>`,x.header[6]=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M4 12h8m-8 6V6m8 12V6"/><circle cx="19" cy="16" r="2"/><path d="M20 10c-2 2-3 3.5-3 6"/></g></svg>`;let S={h1:`Heading 1`,h2:`Heading 2`,h3:`Heading 3`,h4:`Heading 4`,h5:`Heading 5`,h6:`Heading 6`,blockquote:`Blockquote`,codeblock:`Code Block`,code:`Inline Code`,link:`Link`,image:`Image`,video:`Video`,formula:`Formula`,list:`List`,listBullet:`Bullet List`,listOrdered:`Ordered List`,listCheck:`Checklist`},C={blockquote:`Insert blockquote format`},w=[...[,,,,,,].fill(0).map((e,n)=>({type:`item`,name:`h${n+1}`,alias:[`header`,`head${n+1}`],icon:x.header[n+1],title:S[`h${n+1}`],onClick(e,r){e&&this.formatLine(e.index,0,`header`,n+1,t.default.sources.USER)}})),{type:`item`,name:`bq`,alias:[`blockquote`],icon:x.blockquote,title:S.blockquote,descriptions:C.blockquote,onClick(e,n){e&&this.formatLine(e.index,0,`blockquote`,!0,t.default.sources.USER)}},{type:`item`,name:`cb`,alias:[`code`,`codeblock`],icon:x[`code-block`],title:S.codeblock,onClick(e,n){e&&this.formatLine(e.index,0,`code-block`,!0,t.default.sources.USER)}},{type:`item`,name:`lk`,alias:[`link`],icon:x.link,title:S.link,onClick(e,n){if(!e)return;let r=prompt(`Enter link title`);if(!r)return;let i=prompt(`Enter link URL`);i&&(this.insertText(e.index,r,t.default.sources.USER),this.formatText(e.index,e.length+r.length,`link`,i,t.default.sources.USER),this.setSelection({index:e.index,length:e.index+r.length}))}},{type:`item`,name:`img`,alias:[`image`,`pic`,`picture`],icon:x.image,title:S.image,onClick(e,n){if(!e)return;let r=prompt(`Enter image`);r&&this.insertEmbed(e.index,`image`,r,t.default.sources.USER)}},{type:`item`,name:`vd`,alias:[`video`],icon:x.video,title:S.video,onClick(e,n){if(!e)return;let r=prompt(`Enter video`);r&&this.insertEmbed(e.index,`video`,r,t.default.sources.USER)}},{type:`item`,name:`fm`,alias:[`formula`],icon:x.formula,title:S.formula,onClick(e,n){if(!e)return;let r=prompt(`Enter formula`);r&&this.insertEmbed(e.index,`formula`,r,t.default.sources.USER)}},{type:`group`,name:`list`,alias:[],hideSearch:!0,icon:x.list.bullet,title:S.list,children:[{type:`item`,name:`bl`,alias:[`list`,`bullet`],icon:x.list.bullet,title:S.listBullet,onClick(e,n){e&&this.formatLine(e.index,0,`list`,`bullet`,t.default.sources.USER)}},{type:`item`,name:`od`,alias:[`list`,`ordered`],icon:x.list.ordered,title:S.listOrdered,onClick(e,n){e&&this.formatLine(e.index,0,`list`,`ordered`,t.default.sources.USER)}},{type:`item`,name:`ck`,alias:[`list`,`check`],icon:x.list.check,title:S.listCheck,onClick(e,n){e&&this.formatLine(e.index,0,`list`,`unchecked`,t.default.sources.USER)}}]}];function T(e){let n=Object.keys(e),r={};for(let i of n){let[n,a]=i.split(` `),o=f(a);r[i]=b({handler(e,r){this.quill.format(n,o?!r.format[n]:a,t.default.sources.USER)}},e[i])}return r}let E=b({clean:{key:`/`,shortKey:!0,handler(e){this.quill.removeFormat(e.index,e.length,t.default.sources.USER)}}},T({strike:{key:`d`,shortKey:!0},"align ":{key:`l`,altKey:!0},"align center":{key:`c`,altKey:!0},"align right":{key:`r`,altKey:!0},"align justify":{key:`j`,altKey:!0},"indent +1":{key:`]`,shortKey:!0},"indent -1":{key:`[`,shortKey:!0},"script sub":{key:`;`,shortKey:!0},"script super":{key:`'`,shortKey:!0},code:{key:`e`,shortKey:!0},"direction rtl":{key:`r`,shortKey:!0},"direction ":{key:`l`,shortKey:!0}}));function D(e,t){let n=null,r=0;return function(...i){let a=Date.now(),o=t-(a-r);if(o<=0||o>t)n&&(clearTimeout(n),n=null),r=a,e.apply(this,i);else if(!n){let t=e.bind(this,...i);n=setTimeout(()=>{r=Date.now(),n=null,t()},o)}}}function O(e,t){let n=e.toLowerCase(),r=t.toLowerCase();return n===r?2:r.includes(n)?1:0}function k(e,t){let n=e.map(e=>{let n=O(t,e.name);if(e.alias)for(let r of e.alias)n=Math.max(n,O(t,r));return{item:e,score:n}}).filter(({score:e})=>e>=.5);return n.sort((e,t)=>t.score-e.score),n.map(({item:e})=>e)}let A=t.default.import(`ui/icons`);A.header[1]=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h8m-8 6V6m8 12V6m5 6l3-2v8"/></svg>`,A.header[2]=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h8m-8 6V6m8 12V6m9 12h-4c0-4 4-3 4-6c0-1.5-2-2.5-4-1"/></svg>`,A.header[3]=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h8m-8 6V6m8 12V6m5.5 4.5c1.7-1 3.5 0 3.5 1.5a2 2 0 0 1-2 2m-2 3.5c2 1.5 4 .3 4-1.5a2 2 0 0 0-2-2"/></svg>`,A.header[4]=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18V6m5 4v3a1 1 0 0 0 1 1h3m0-4v8M4 12h8m-8 6V6"/></svg>`,A.header[5]=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h8m-8 6V6m8 12V6m5 7v-3h4m-4 7.7c.4.2.8.3 1.3.3c1.5 0 2.7-1.1 2.7-2.5S19.8 13 18.3 13H17"/></svg>`,A.header[6]=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M4 12h8m-8 6V6m8 12V6"/><circle cx="19" cy="16" r="2"/><path d="M20 10c-2 2-3 3.5-3 6"/></g></svg>`;let j={PLACEHOLDER:`shortcut-key.placeholder`,H1_TITLE:`shortcut-key.h1.title`,H2_TITLE:`shortcut-key.h2.title`,H3_TITLE:`shortcut-key.h3.title`,H4_TITLE:`shortcut-key.h4.title`,H5_TITLE:`shortcut-key.h5.title`,H6_TITLE:`shortcut-key.h6.title`,BLOCKQUOTE_TITLE:`shortcut-key.blockquote.title`,BLOCKQUOTE_DESCRIPTIONS:`shortcut-key.blockquote.descriptions`,CODEBLOCK_TITLE:`shortcut-key.codeblock.title`,CODE_TITLE:`shortcut-key.code.title`,LINK_TITLE:`shortcut-key.link.title`,IMAGE_TITLE:`shortcut-key.image.title`,VIDEO_TITLE:`shortcut-key.video.title`,FORMULA_TITLE:`shortcut-key.formula.title`,LIST_TITLE:`shortcut-key.list.title`,LIST_BULLET_TITLE:`shortcut-key.listBullet.title`,LIST_ORDERED_TITLE:`shortcut-key.listOrdered.title`,LIST_CHECK_TITLE:`shortcut-key.listCheck.title`,TABLE_TITLE:`shortcut-key.table.title`},M={"en-US":{"shortcut-key":{placeholder:`Type / for commands`,h1:{title:`Heading 1`},h2:{title:`Heading 2`},h3:{title:`Heading 3`},h4:{title:`Heading 4`},h5:{title:`Heading 5`},h6:{title:`Heading 6`},blockquote:{title:`Blockquote`,descriptions:`Insert blockquote format`},codeblock:{title:`Code Block`},code:{title:`Inline Code`},link:{title:`Link`},image:{title:`Image`},video:{title:`Video`},formula:{title:`Formula`},list:{title:`List`},listBullet:{title:`Bullet List`},listOrdered:{title:`Ordered List`},listCheck:{title:`Checklist`},table:{title:`Table`}}},"zh-CN":{"shortcut-key":{placeholder:`输入 / 调用菜单`,h1:{title:`标题1`},h2:{title:`标题2`},h3:{title:`标题3`},h4:{title:`标题4`},h5:{title:`标题5`},h6:{title:`标题6`},blockquote:{title:`引用`,descriptions:`插入引用格式`},codeblock:{title:`代码块`},code:{title:`行内代码`},link:{title:`链接`},image:{title:`图片`},video:{title:`视频`},formula:{title:`公式`},list:{title:`列表`},listBullet:{title:`无序列表`},listOrdered:{title:`有序列表`},listCheck:{title:`任务列表`},table:{title:`表格`}}}};function N(e){let t=this.quill.getModule(`i18n`);return t&&typeof t.t==`function`?t.t(e):{[j.PLACEHOLDER]:`Type / for commands`,[j.H1_TITLE]:`Heading 1`,[j.H2_TITLE]:`Heading 2`,[j.H3_TITLE]:`Heading 3`,[j.H4_TITLE]:`Heading 4`,[j.H5_TITLE]:`Heading 5`,[j.H6_TITLE]:`Heading 6`,[j.BLOCKQUOTE_TITLE]:`Blockquote`,[j.BLOCKQUOTE_DESCRIPTIONS]:`Insert blockquote format`,[j.CODEBLOCK_TITLE]:`Code Block`,[j.CODE_TITLE]:`Inline Code`,[j.LINK_TITLE]:`Link`,[j.IMAGE_TITLE]:`Image`,[j.VIDEO_TITLE]:`Video`,[j.FORMULA_TITLE]:`Formula`,[j.LIST_TITLE]:`List`,[j.LIST_BULLET_TITLE]:`Bullet List`,[j.LIST_ORDERED_TITLE]:`Ordered List`,[j.LIST_CHECK_TITLE]:`Checklist`,[j.TABLE_TITLE]:`Table`}[e]||e}function P(){return N.call(this,j.PLACEHOLDER)}let F=[...[,,,,,,].fill(0).map((e,n)=>({type:`item`,name:`h${n+1}`,alias:[`header`,`head${n+1}`],icon:A.header[n+1],title(){return N.call(this,`shortcut-key.h${n+1}.title`)},onClick(e,r){e&&this.formatLine(e.index,0,`header`,n+1,t.default.sources.USER)}})),{type:`item`,name:`bq`,alias:[`blockquote`],icon:A.blockquote,title(){return N.call(this,j.BLOCKQUOTE_TITLE)},descriptions(){return N.call(this,j.BLOCKQUOTE_DESCRIPTIONS)},onClick(e,n){e&&this.formatLine(e.index,0,`blockquote`,!0,t.default.sources.USER)}},{type:`item`,name:`cb`,alias:[`code`,`codeblock`],icon:A[`code-block`],title(){return N.call(this,j.CODEBLOCK_TITLE)},onClick(e,n){e&&this.formatLine(e.index,0,`code-block`,!0,t.default.sources.USER)}},{type:`item`,name:`lk`,alias:[`link`],icon:A.link,title(){return N.call(this,j.LINK_TITLE)},onClick(e,n){if(!e)return;let r=prompt(`Enter link title`);if(!r)return;let i=prompt(`Enter link URL`);i&&(this.insertText(e.index,r,t.default.sources.USER),this.formatText(e.index,e.length+r.length,`link`,i,t.default.sources.USER),this.setSelection({index:e.index,length:e.index+r.length}))}},{type:`item`,name:`img`,alias:[`image`,`pic`,`picture`],icon:A.image,title(){return N.call(this,j.IMAGE_TITLE)},onClick(e,n){if(!e)return;let r=prompt(`Enter image`);r&&this.insertEmbed(e.index,`image`,r,t.default.sources.USER)}},{type:`item`,name:`vd`,alias:[`video`],icon:A.video,title(){return N.call(this,j.VIDEO_TITLE)},onClick(e,n){if(!e)return;let r=prompt(`Enter video`);r&&this.insertEmbed(e.index,`video`,r,t.default.sources.USER)}},{type:`item`,name:`fm`,alias:[`formula`],icon:A.formula,title(){return N.call(this,j.FORMULA_TITLE)},onClick(e,n){if(!e)return;let r=prompt(`Enter formula`);r&&this.insertEmbed(e.index,`formula`,r,t.default.sources.USER)}},{type:`group`,name:`list`,alias:[],hideSearch:!0,icon:A.list.bullet,title(){return N.call(this,j.LIST_TITLE)},children:[{type:`item`,name:`bl`,alias:[`list`,`bullet`],icon:A.list.bullet,title(){return N.call(this,j.LIST_BULLET_TITLE)},onClick(e,n){e&&this.formatLine(e.index,0,`list`,`bullet`,t.default.sources.USER)}},{type:`item`,name:`od`,alias:[`list`,`ordered`],icon:A.list.ordered,title(){return N.call(this,j.LIST_ORDERED_TITLE)},onClick(e,n){e&&this.formatLine(e.index,0,`list`,`ordered`,t.default.sources.USER)}},{type:`item`,name:`ck`,alias:[`list`,`check`],icon:A.list.check,title(){return N.call(this,j.LIST_CHECK_TITLE)},onClick(e,n){e&&this.formatLine(e.index,0,`list`,`unchecked`,t.default.sources.USER)}}]}];function I(e,n={}){let{useI18n:r=!1}=n,i=e({row:8,col:8,customBtn:!1}),a=()=>{let{row:e,col:t}=i.dataset;for(let e of Array.from(i.querySelectorAll(`.active`)))e.classList.remove(`active`);if(!e||!t)return;let n=Array.from(i.querySelectorAll(`.table-up-select-box__item`));for(let r of n){let{row:n,col:i}=r.dataset;if(n>e&&i>t)return;r.classList.toggle(`active`,n<=e&&i<=t)}};return{tableUpKeyboardControl:(e,{currentMenu:t})=>{if(!t.contains(i))return!1;let n=Number(i.dataset.row),r=Number(i.dataset.col);switch(e.key){case`ArrowUp`:--n;break;case`ArrowDown`:n+=1;break;case`ArrowRight`:r+=1;break;case`ArrowLeft`:--r;break;default:return!1}return n<=0||r<=0?!1:(n=Math.min(n,8),r=Math.min(r,8),i.dataset.row=String(n),i.dataset.col=String(r),a(),e.preventDefault(),!0)},tableUpConfig:{type:`group`,name:`table`,alias:[],title(){return r?N.call(this,j.TABLE_TITLE):`Table`},icon:t.default.import(`ui/icons`).table,onOpenSub(e){let t=e.item.querySelector(`.qsf-menu`);t&&(t.style.width=`auto`),i.dataset.row=`1`,i.dataset.col=`1`,a()},children:[{type:`item`,name:`table`,alias:[],classes:[`no-selected-style`],hideSearch:!0,content(){return i},onClick(){let{row:e,col:t}=i.dataset;!e||!t||this.getModule(`table-up`).insertTable(Number(e),Number(t))}}]}}}let L=t.default.import(`parchment`);var R=class{constructor(e,n){this.quill=e,v(this,`bem`,l(`qsf`,`menu`)),v(this,`options`,void 0),v(this,`menuSorter`,void 0),v(this,`currentMenu`,void 0),v(this,`menuContainer`,void 0),v(this,`menuKeyboardControlsCleanup`,void 0),v(this,`currentRange`,{index:0,length:0}),v(this,`placeholderBem`,l(`qsf`,`placeholder`)),v(this,`placeholderTip`,void 0),v(this,`destroyMenuList`,()=>{this.quill.root.removeEventListener(`click`,this.destroyMenuList),this.menuKeyboardControlsCleanup&&this.menuKeyboardControlsCleanup(),this.menuContainer&&(this.menuContainer.remove(),this.menuContainer=void 0)}),this.options=this.resolveOptions(n),this.currentMenu=this.options.menuItems,this.menuSorter=k.bind(this,this.getAllMenuItems()),this.placeholderTip=this.initPlaceholder(),this.placeholderUpdate(),this.quill.on(t.default.events.COMPOSITION_START,()=>{this.placeholderHide()}),this.quill.on(t.default.events.COMPOSITION_END,()=>{this.placeholderUpdate()}),this.quill.on(t.default.events.EDITOR_CHANGE,(e,n)=>{if(this.placeholderUpdate(),e===t.default.events.SELECTION_CHANGE){let e=n;if(e&&e.length===0){let[t,n]=this.quill.getLine(e.index);if(t){let r=e.index-n,i=r+t.length(),a=this.quill.getText(r,i),o=this.quill.getFormat(e.index,e.length),s=this.hasBlockFormat(o);if(a.startsWith(`/`)&&!s){let e=a.match(/^\/(.+)/);e?this.currentMenu=this.menuSorter(e[1]):this.currentMenu=this.options.menuItems,this.updateMenuList(t,o);return}}}this.destroyMenuList()}else if(e===t.default.events.TEXT_CHANGE){let e=n;for(let t of e.ops)if(t.insert)if(t.insert===`/`)this.generateMenuList();else break}}),this.quill.root.addEventListener(`scroll`,()=>{this.placeholderUpdate()})}resolveOptions(e){return Object.assign({placeholder:`Type / for commands`,menuItems:[],menuKeyboardControls:()=>!1},e)}getAllMenuItems(){let e=[];for(let t of this.options.menuItems)t.hideSearch||e.push(t),t.type===`group`&&e.push(...t.children.filter(e=>!e.hideSearch));return e}hasBlockFormat(e){return Object.keys(e).some(e=>this.quill.scroll.registry.query(e,L.Scope.BLOCK_BLOT))}initPlaceholder(){let e=this.quill.addContainer(this.placeholderBem.be(`wrapper`)),t=this.quill.addContainer(this.placeholderBem.b());return e.appendChild(t),this.updatePlaceholderText(t),t}updatePlaceholderText(e=this.placeholderTip){if(!e)return;let t=m(this.options.placeholder)?this.options.placeholder.call(this):this.options.placeholder;e.dataset.placeholder=t}placeholderUpdate(){let e=this.quill.getSelection();if(e&&(this.currentRange=e),!this.quill.hasFocus()){this.placeholderHide();return}if(this.currentRange.length===0){let[e]=this.quill.getLine(this.currentRange.index);if(e&&e.length()<=1){let t=this.quill.getContents(this.currentRange.index,e.length()||0).ops[0],n=this.hasBlockFormat(t.attributes||{}),r=!1;if(p(t.insert)||(r=this.hasBlockFormat(t.insert||{})),!n&&!r){let e=this.quill.getBounds(this.currentRange);if(e){this.placeholderTip.classList.remove(this.placeholderBem.is(`hidden`),this.placeholderBem.is(`right`));let n={left:`${e.left}px`,top:`${e.top}px`};t.attributes&&t.attributes.align===`right`&&(this.placeholderTip.classList.add(this.placeholderBem.is(`right`)),n.left=`${e.right-1}px`),Object.assign(this.placeholderTip.style,n)}return}}}this.placeholderHide()}placeholderHide(){this.placeholderTip.classList.add(this.placeholderBem.is(`hidden`))}generateMenuItem(e,t){return b(b({},t),{},{type:`item`,children:(t.children||[]).map(t=>this.generateMenuItem(e,t)),content:()=>{if(t.content)return t.content();{let e=document.createElement(`div`);if(e.classList.add(this.bem.be(`item-container`)),t.icon){let n=document.createElement(`div`);n.classList.add(this.bem.be(`item-icon`));let r=document.createElement(`div`);r.classList.add(this.bem.be(`icon`)),r.innerHTML=t.icon,n.appendChild(r),e.appendChild(n)}let n=document.createElement(`div`);n.classList.add(this.bem.be(`item-content`));let r=document.createElement(`div`);r.classList.add(this.bem.be(`item-title`));let i=document.createElement(`span`),a=m(t.title)?t.title.call(this):t.title;if(i.textContent=a==null?``:a,r.appendChild(i),t.type===`item`){let e=document.createElement(`span`);e.classList.add(this.bem.be(`item-hint`)),e.textContent=`/${t.name}`,r.appendChild(e)}if(n.appendChild(r),t.descriptions){let e=document.createElement(`div`);e.classList.add(this.bem.be(`item-descriptions`));let r=m(t.descriptions)?t.descriptions.call(this):t.descriptions;e.textContent=r==null?``:r,n.appendChild(e)}return e.appendChild(n),e}},onClose:e=>{t.onCloseSub&&t.onCloseSub.call(this.quill,e)},onOpen:e=>{t.onOpenSub&&t.onOpenSub.call(this.quill,e)},onClick:n=>{if(t.type===`item`&&(e.domNode.innerHTML=``,this.destroyMenuList()),t.onClick){let e=this.quill.getSelection();t.onClick.call(this.quill,e,n)}}})}generateMenuList(){this.menuContainer||(this.menuContainer=document.createElement(`div`),this.menuContainer.classList.add(this.bem.be(`container`)),this.quill.root.addEventListener(`click`,this.destroyMenuList),this.quill.container.appendChild(this.menuContainer))}updateMenuList(e,t){if(!this.menuContainer)return;this.menuContainer.innerHTML=``;let n=d(this.currentMenu.map(t=>this.generateMenuItem(e,t)));this.menuKeyboardControlsCleanup&&this.menuKeyboardControlsCleanup(),this.menuKeyboardControlsCleanup=this.setupMenuKeyboardControls({wrapper:n,target:this.quill.root,menuControl:this.options.menuKeyboardControls});let r=this.quill.root.getBoundingClientRect(),i=e.domNode.getBoundingClientRect(),a=i.left-r.left+(t.align===`right`?i.width:0),o=i.bottom-r.top;Object.assign(this.menuContainer.style,{left:`${a}px`,top:`${o}px`}),this.menuContainer.appendChild(n),requestAnimationFrame(()=>{if(!this.menuContainer)return;let e=this.menuContainer.getBoundingClientRect();window.innerWidth<e.right&&(this.menuContainer.style.left=`${a-e.width}px`),window.innerHeight<e.bottom&&(this.menuContainer.style.top=`${o-i.height-e.height}px`)})}refreshMenu(){if(this.updatePlaceholderText(),!this.menuContainer)return;let e=this.quill.getSelection();if(!e)return;let[t,n]=this.quill.getLine(e.index);if(!t)return;let r=e.index-n,i=r+t.length(),a=this.quill.getText(r,i),o=this.quill.getFormat(e.index,e.length);if(a.startsWith(`/`)&&!this.hasBlockFormat(o)){let e=a.match(/^\/(.+)/);e?this.currentMenu=this.menuSorter(e[1]):this.currentMenu=this.options.menuItems,this.updateMenuList(t,o)}}setupMenuKeyboardControls({wrapper:e,target:t,menuControl:n}){let r=e,i=null,a=-1,o=e=>{let t=Array.from(r.querySelectorAll(`.${this.bem.be(`item`)}`));for(let[n,i]of t.entries())if(n===e){i.classList.add(this.bem.is(`selected`));let e=r.getBoundingClientRect(),t=i.getBoundingClientRect(),n=t.bottom>e.bottom,a=t.top<e.top;n?r.scrollTop=i.offsetTop-r.clientHeight+t.height:a&&(r.scrollTop=i.offsetTop)}else i.classList.remove(this.bem.is(`selected`));a=e},s=D(e=>{let t=r.querySelectorAll(`:scope > .${this.bem.be(`item`)}`);if((t.length===0&&e.key===`Enter`||e.key===`Escape`)&&(e.preventDefault(),this.destroyMenuList()),t.length!==0&&!n(e,{currentMenu:r,selectedIndex:a}))switch(e.key){case`ArrowUp`:e.preventDefault(),a===-1&&(a=0),o((a-1+t.length)%t.length);break;case`ArrowDown`:e.preventDefault(),o((a+1)%t.length);break;case`ArrowRight`:{e.preventDefault();let n=t[a];if(!n)return;if(n.dataset.hasChildren===`true`){n.click();let e=n.querySelector(`.${this.bem.b()}`);e&&(i=r,r=e,o(0))}break}case`ArrowLeft`:if(e.preventDefault(),i){let e=Number.parseInt(r.dataset.parent||`0`,10);r=i,i=null,a=e,o(a);let t=Array.from(r.querySelectorAll(`.${this.bem.be(`item`)}`))[a];if(!t)return;t.dispatchEvent(new MouseEvent(`mouseleave`))}break;case`Enter`:{e.preventDefault();let n=t[Math.max(0,a)];if(n&&(n.click(),n.dataset.hasChildren===`true`)){let e=n.querySelector(`.${this.bem.b()}`);e&&(i=r,r=e,o(0))}break}}},100),c=e=>{new Set([`ArrowUp`,`ArrowDown`,`ArrowRight`,`ArrowLeft`,`Enter`,`Escape`]).has(e.key)&&e.preventDefault(),s(e)};return t.addEventListener(`keydown`,c,!0),()=>{t.removeEventListener(`keydown`,c,!0)}}};e.I18N_KEYS=j,e.QuillShortcutKey=R,e.default=R,e.defaultI18nMenuItems=F,e.defaultI18nMessages=M,e.defaultI18nPlaceholder=P,e.defaultMenuItems=w,e.defaultShortKey=E,e.generateTableUpShortKeyMenu=I,e.searchAndSort=k,e.t=N});
//# sourceMappingURL=index.umd.js.map