!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("quill")):"function"==typeof define&&define.amd?define(["exports","quill"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).bundle={},e.Quill)}(this,(function(e,t){"use strict";const s=t.import("ui/icons"),i=[{name:"h1",alias:["header","head","head1"],icons:s.header[1],title:"标题1",handler(){const e=this.getSelection();e&&this.insertEmbed(e.index,"header","1",t.sources.USER)}},{name:"h2",alias:["header","head","head2"],icons:s.header[2],title:"标题2",handler(){const e=this.getSelection();e&&this.insertEmbed(e.index,"header","2",t.sources.USER)}},{name:"h3",alias:["header","head","head3"],icons:s.header[3],title:"标题3",handler(){const e=this.getSelection();e&&this.insertEmbed(e.index,"header","3",t.sources.USER)}}];class n{index=new Map;items=[];SCORE_THRESHOLD=40;constructor(e){this.items=e,this.buildIndex()}buildIndex(){for(const e of this.items){this.addToIndex(e.name.toLowerCase(),e);for(const t of e.alias)this.addToIndex(t.toLowerCase(),e)}}addToIndex(e,t){this.addTermToIndex(e,t);for(let s=0;s<e.length-1;s++)for(let i=s+2;i<=Math.min(e.length,s+5);i++)this.addTermToIndex(e.slice(s,i),t)}addTermToIndex(e,t){this.index.has(e)||this.index.set(e,new Set),this.index.get(e).add(t)}getQuickSimilarity(e,t){const s=new Map;for(const t of e)s.set(t,(s.get(t)||0)+1);let i=0;for(const e of t){const t=s.get(e);t&&t>0&&(i++,s.set(e,t-1))}return 2*i/(e.length+t.length)*50}search(e){e=e.toLowerCase();const t=new Map,s=new Set,i=this.index.get(e)||new Set;for(const e of i)t.set(e,100),s.add(e);for(const i of this.items){if(s.has(i))continue;const n=[i.name.toLowerCase(),...i.alias.map((e=>e.toLowerCase()))];let o=0;for(const t of n)t.includes(e)?o=Math.max(o,80):e.includes(t)&&(o=Math.max(o,60));o>0&&(t.set(i,o),s.add(i))}if(e.length>1)for(const i of this.items)if(!s.has(i)){const s=[i.name.toLowerCase(),...i.alias.map((e=>e.toLowerCase()))],n=Math.max(...s.map((t=>this.getQuickSimilarity(e,t))));n>=this.SCORE_THRESHOLD&&t.set(i,n)}return[...t.entries()].filter((([e,t])=>t>=this.SCORE_THRESHOLD)).sort(((e,t)=>t[1]-e[1])).map((([e])=>e))}}class o{quill;options;menuSorter;constructor(e,s){this.quill=e,this.options=this.resolveOptions(s),this.menuSorter=this.createMenuItemsSorter(this.options.menuItems),this.quill.on(t.events.EDITOR_CHANGE,(()=>{const e=this.quill.getSelection();if(!e)return;const[t,s]=this.quill.getLine(e.index);if(!t)return;const i=this.quill.getText(e.index-s,e.index-s+t.length()),n=i.match(/^\/(.+)/);i.startsWith("/")&&n&&console.log(this.menuSorter(n[1]).map((e=>e.name)))}))}resolveOptions(e){return Object.assign({menuItems:[]},e)}createMenuItemsSorter(e){const t=new n(e);return e=>t.search(e)}}e.QuillQuickInsert=o,e.default=o,e.defaultMenuItems=i,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=dev.js.map
