!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("quill")):"function"==typeof define&&define.amd?define(["exports","quill"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).bundle={},e.Quill)}(this,(function(e,t){"use strict";const n=(e,t)=>{const n=`${e}-`;return{b:()=>`${n}${t}`,be:e=>e?`${n}${t}__${e}`:"",bm:e=>e?`${n}${t}--${e}`:"",bem:(e,i)=>e&&i?`${n}${t}__${e}--${i}`:"",ns:e=>e?`${n}${e}`:"",bs:e=>e?`${n}${t}-${e}`:"",cv:e=>e?`--${n}${e}`:"",is:e=>`is-${e}`}},i=e=>{const t=n("qsf","menu"),s=document.createElement("div");s.classList.add(t.b());for(const[n,o]of e.entries()){const{type:e,classes:r=[]}=o,d=document.createElement("div");if(d.classList.add(t.be("item-container"),...r),"break"===e)d.classList.add(t.is("break"));else{if("item"!==e)continue;{const{icon:e,text:s,content:r,children:l=[],onHover:c,onClick:a}=o;if(!e&&!s&&!r)continue;if(r)d.appendChild(r());else{if(e){const n=document.createElement("span");n.classList.add(t.be("icon")),n.innerHTML=e,d.appendChild(n)}if(s){const e=document.createElement("span");e.textContent=s,d.appendChild(e)}}if(l.length>0){const e=document.createElement("span");e.classList.add(t.be("icon"),t.is("arrow")),e.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"></path></svg>',d.appendChild(e);const n=i(l);let s;n.classList.add(t.is("transparent"));const o=()=>{n.remove()};for(const e of[d,n])e.addEventListener("mouseenter",(()=>{s&&(clearTimeout(s),s=void 0),d.classList.add(t.is("active")),n.removeEventListener("transitionend",o);const e=d.getBoundingClientRect();Object.assign(n.style,{position:"fixed",width:`${e.width}px`,top:`${e.top}px`,left:`${e.right}px`}),document.body.contains(n)||document.body.appendChild(n),requestAnimationFrame((()=>{n.classList.remove(t.is("transparent"));const i=n.getBoundingClientRect();i.right>window.innerWidth&&Object.assign(n.style,{left:e.left-i.width+"px"}),i.bottom>window.innerHeight&&Object.assign(n.style,{top:e.bottom-i.height+"px"})}))})),e.addEventListener("mouseleave",(()=>{s&&(clearTimeout(s),s=void 0),d.classList.remove(t.is("active")),s=setTimeout((()=>{n.addEventListener("transitionend",o,{once:!0}),n.classList.add(t.is("transparent"))}),150)}))}c&&d.addEventListener("mouseenter",(()=>c(o,n))),a&&d.addEventListener("click",(()=>a(o,n)))}}s.appendChild(d)}return s},s=t.import("ui/icons");s.header[1]='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h8m-8 6V6m8 12V6m5 6l3-2v8"/></svg>',s.header[2]='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h8m-8 6V6m8 12V6m9 12h-4c0-4 4-3 4-6c0-1.5-2-2.5-4-1"/></svg>',s.header[3]='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h8m-8 6V6m8 12V6m5.5 4.5c1.7-1 3.5 0 3.5 1.5a2 2 0 0 1-2 2m-2 3.5c2 1.5 4 .3 4-1.5a2 2 0 0 0-2-2"/></svg>',s.header[4]='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18V6m5 4v3a1 1 0 0 0 1 1h3m0-4v8M4 12h8m-8 6V6"/></svg>',s.header[5]='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h8m-8 6V6m8 12V6m5 7v-3h4m-4 7.7c.4.2.8.3 1.3.3c1.5 0 2.7-1.1 2.7-2.5S19.8 13 18.3 13H17"/></svg>',s.header[6]='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M4 12h8m-8 6V6m8 12V6"/><circle cx="19" cy="16" r="2"/><path d="M20 10c-2 2-3 3.5-3 6"/></g></svg>',console.log(s);const o={h1:"标题1",h2:"标题2",h3:"标题3",h4:"标题4",h5:"标题5",h6:"标题6",blockquote:"引用",codeblock:"代码块",code:"行内代码"},r=[...new Array(6).fill(0).map(((e,n)=>({name:`h${n+1}`,alias:["header",`head${n+1}`],icon:s.header[n+1],title:o[`h${n+1}`],handler(){const e=this.getSelection();e&&this.formatLine(e.index,e.index,"header",n+1,t.sources.USER)}}))),{name:"yy",alias:["blockquote","bq"],icon:s.blockquote,title:o.blockquote,descriptions:"插入引用格式",handler(){const e=this.getSelection();e&&this.formatLine(e.index,e.index,"blockquote",!0,t.sources.USER)}},{name:"dm",alias:["code","codeblock"],icon:s["code-block"],title:o.codeblock,handler(){const e=this.getSelection();e&&this.formatLine(e.index,e.index,"code-block",!0,t.sources.USER)}},{name:"hndm",alias:["code","inlinecode"],icon:s.code,title:o.code,handler(){this.getSelection()&&this.format("code",!0,t.sources.USER)}}];class d{index=new Map;items=[];SCORE_THRESHOLD=20;constructor(e){this.items=e,this.buildIndex()}buildIndex(){for(const e of this.items){this.addToIndex(e.name.toLowerCase(),e);for(const t of e.alias)this.addToIndex(t.toLowerCase(),e)}}addToIndex(e,t){this.addTermToIndex(e,t);for(let n=0;n<e.length-1;n++)for(let i=n+2;i<=Math.min(e.length,n+5);i++)this.addTermToIndex(e.slice(n,i),t)}addTermToIndex(e,t){this.index.has(e)||this.index.set(e,new Set),this.index.get(e).add(t)}getQuickSimilarity(e,t){const n=new Map;for(const t of e)n.set(t,(n.get(t)||0)+1);let i=0;for(const e of t){const t=n.get(e);t&&t>0&&(i++,n.set(e,t-1))}return 2*i/(e.length+t.length)*50}search(e){e=e.toLowerCase();const t=new Map,n=new Set,i=this.index.get(e)||new Set;for(const e of i)t.set(e,100),n.add(e);for(const i of this.items){if(n.has(i))continue;const s=[i.name.toLowerCase(),...i.alias.map((e=>e.toLowerCase()))];let o=0;for(const t of s)t.includes(e)?o=Math.max(o,80):e.includes(t)&&(o=Math.max(o,60));o>0&&(t.set(i,o),n.add(i))}if(e.length>1)for(const i of this.items)if(!n.has(i)){const n=[i.name.toLowerCase(),...i.alias.map((e=>e.toLowerCase()))],s=Math.max(...n.map((t=>this.getQuickSimilarity(e,t))));s>=this.SCORE_THRESHOLD&&t.set(i,s)}return console.log(t),[...t.entries()].filter((([e,t])=>t>=this.SCORE_THRESHOLD)).sort(((e,t)=>t[1]-e[1])).map((([e])=>e))}}const l=t.import("parchment");class c{quill;bem=n("qsf","menu");options;menuSorter;currentMenu;menuContainer;selectedItemIndex=-1;constructor(e,n){this.quill=e,this.options=this.resolveOptions(n),this.currentMenu=this.options.menuItems,this.menuSorter=this.createMenuItemsSorter(this.options.menuItems),this.quill.on(t.events.TEXT_CHANGE,(()=>{const e=this.quill.getSelection();if(e){const[t,n]=this.quill.getLine(e.index);if(t){const i=e.index-n,s=i+t.length(),o=this.quill.getText(i,s),r=this.quill.getFormat(i,s),d=Object.keys(r).some((e=>this.quill.scroll.registry.query(e,l.Scope.BLOCK_BLOT)));if(o.startsWith("/")&&!d){const e=o.match(/^\/(.+)/);if(e){const t=this.menuSorter(e[1]);this.currentMenu=t}else this.currentMenu=this.options.menuItems;return void this.generateMenuList(t,r)}}}this.destroyMenuList()}))}resolveOptions(e){return Object.assign({menuItems:[]},e)}createMenuItemsSorter(e){const t=new d(e);return e=>t.search(e)}generateMenuList(e,t){const n=i(this.currentMenu.map((t=>({type:"item",content:()=>{const e=document.createElement("div");e.classList.add(this.bem.be("item"));const n=document.createElement("div");n.classList.add(this.bem.be("item-icon"));const i=document.createElement("div");i.classList.add(this.bem.be("icon")),i.innerHTML=t.icon,n.appendChild(i);const s=document.createElement("div");s.classList.add(this.bem.be("item-content"));const o=document.createElement("div");o.classList.add(this.bem.be("item-title"));const r=document.createElement("span");r.textContent=t.title;const d=document.createElement("span");if(d.classList.add(this.bem.be("item-hint")),d.textContent=`/${t.name}`,o.appendChild(r),o.appendChild(d),s.appendChild(o),t.descriptions){const e=document.createElement("div");e.classList.add(this.bem.be("item-descriptions")),e.textContent=t.descriptions,s.appendChild(e)}return e.appendChild(n),e.appendChild(s),e},onClick:()=>{e.domNode.innerHTML="",t.handler.call(this.quill,t.name),this.destroyMenuList()},onHover:()=>{this.selectedItemIndex-=1,this.setMenuSelected()}}))));this.selectedItemIndex=-1,this.menuContainer?this.menuContainer.innerHTML="":(this.menuContainer=document.createElement("div"),this.menuContainer.classList.add(this.bem.be("container")),this.quill.root.addEventListener("keydown",this.handleMenuControl,!0),this.quill.root.addEventListener("click",this.destroyMenuList),this.quill.container.appendChild(this.menuContainer));const s=this.quill.root.getBoundingClientRect(),o=e.domNode.getBoundingClientRect();Object.assign(this.menuContainer.style,{left:`${s.left+("right"===t.align?o.width:0)}px`,top:o.bottom-s.top+"px"}),this.menuContainer.appendChild(n),requestAnimationFrame((()=>{if(!this.menuContainer)return;const e=this.menuContainer.getBoundingClientRect();window.innerWidth<e.right&&(this.menuContainer.style.left=e.left-e.width+"px"),window.innerHeight<e.bottom&&(this.menuContainer.style.top=o.top-s.top-e.height+"px")}))}handleMenuControl=e=>{if(new Set(["Escape","Enter","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"]).has(e.code)&&this.menuContainer){if(e.stopImmediatePropagation(),e.preventDefault(),-1!==this.selectedItemIndex&&"Enter"===e.code){const e=this.menuContainer.querySelector(`.${this.bem.is("selected")}`);return void(e&&e.click())}switch(e.code){case"Escape":return void this.destroyMenuList();case"ArrowDown":this.selectedItemIndex+=1,this.selectedItemIndex%=this.currentMenu.length;break;case"ArrowUp":this.selectedItemIndex-=1,this.selectedItemIndex<0&&(this.selectedItemIndex=this.currentMenu.length-1)}this.setMenuSelected()}};setMenuSelected(){if(this.menuContainer){for(const e of Array.from(this.menuContainer.querySelectorAll(`.${this.bem.is("selected")}`)))e.classList.remove(this.bem.is("selected"));if(-1!==this.selectedItemIndex){const e=this.menuContainer.querySelectorAll(`.${this.bem.be("item-container")}`)[this.selectedItemIndex];if(e){e.classList.add(this.bem.is("selected"));const t=this.menuContainer.getBoundingClientRect(),n=e.getBoundingClientRect(),i=n.bottom>t.bottom,s=n.top<t.top;return i?this.menuContainer.scrollTop=e.offsetTop-this.menuContainer.clientHeight+n.height:s&&(this.menuContainer.scrollTop=e.offsetTop),!0}}}return!1}destroyMenuList=()=>{this.quill.root.removeEventListener("keydown",this.handleMenuControl,!0),this.quill.root.removeEventListener("click",this.destroyMenuList),this.menuContainer&&(this.menuContainer.remove(),this.menuContainer=void 0)}}e.QuillQuickInsert=c,e.default=c,e.defaultMenuItems=r,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=dev.js.map
