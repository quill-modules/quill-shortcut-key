!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("quill")):"function"==typeof define&&define.amd?define(["exports","quill"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).QuillShortcutKey={},e.Quill)}(this,(function(e,t){"use strict";const n=(e,t)=>{const n=`${e}-`;return{b:()=>`${n}${t}`,be:e=>e?`${n}${t}__${e}`:"",bm:e=>e?`${n}${t}--${e}`:"",bem:(e,i)=>e&&i?`${n}${t}__${e}--${i}`:"",ns:e=>e?`${n}${e}`:"",bs:e=>e?`${n}${t}-${e}`:"",cv:e=>e?`--${n}${e}`:"",is:e=>`is-${e}`}},i=n("qsf","menu"),o=e=>{const t=document.createElement("div");t.classList.add(i.b());for(const[n,s]of e.entries()){const{type:e,classes:r=[]}=s,l=document.createElement("div");if(l.classList.add(i.be("item"),...r),"break"===e)l.classList.add(i.is("break"));else{if("item"!==e)continue;{const{icon:e,text:t,content:r,children:a=[],onHover:c,onClick:d,onClose:u,onOpen:h}=s;if(!e&&!t&&!r)continue;const m={data:s,index:n,item:l};if(r)l.appendChild(r());else{if(e){const t=document.createElement("span");t.classList.add(i.be("icon")),t.innerHTML=e,l.appendChild(t)}if(t){const e=document.createElement("span");e.textContent=t,l.appendChild(e)}}if(a.length>0){l.dataset.hasChildren="true";const e=document.createElement("span");e.classList.add(i.be("icon"),i.is("arrow")),e.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"></path></svg>',l.appendChild(e);const t=o(a);let s;t.classList.add(i.is("transparent"));const r=()=>{t.remove(),u?.(m)},c=()=>{if(l.contains(t))return;s&&(clearTimeout(s),s=void 0),l.classList.add(i.is("active")),t.dataset.parent=n.toString(),t.removeEventListener("transitionend",r);const e=l.getBoundingClientRect();Object.assign(t.style,{position:"fixed",top:`${e.top}px`,left:`${e.right}px`}),l.appendChild(t),requestAnimationFrame((()=>{t.classList.remove(i.is("transparent"));const n=t.getBoundingClientRect();n.right>window.innerWidth&&Object.assign(t.style,{left:e.left-n.width+"px"}),n.bottom>window.innerHeight&&Object.assign(t.style,{top:e.bottom-n.height+"px"}),h?.(m)}))},d=()=>{s&&(clearTimeout(s),s=void 0),s=setTimeout((()=>{t.addEventListener("transitionend",r,{once:!0}),t.classList.add(i.is("transparent"))}),150)};l.addEventListener("click",c),l.addEventListener("mouseenter",c),l.addEventListener("mouseleave",d)}c&&l.addEventListener("mouseenter",(()=>c(m))),d&&l.addEventListener("click",(()=>d(m)))}}t.appendChild(l)}return t},s=t.import("ui/icons");s.header[1]='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h8m-8 6V6m8 12V6m5 6l3-2v8"/></svg>',s.header[2]='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h8m-8 6V6m8 12V6m9 12h-4c0-4 4-3 4-6c0-1.5-2-2.5-4-1"/></svg>',s.header[3]='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h8m-8 6V6m8 12V6m5.5 4.5c1.7-1 3.5 0 3.5 1.5a2 2 0 0 1-2 2m-2 3.5c2 1.5 4 .3 4-1.5a2 2 0 0 0-2-2"/></svg>',s.header[4]='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18V6m5 4v3a1 1 0 0 0 1 1h3m0-4v8M4 12h8m-8 6V6"/></svg>',s.header[5]='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h8m-8 6V6m8 12V6m5 7v-3h4m-4 7.7c.4.2.8.3 1.3.3c1.5 0 2.7-1.1 2.7-2.5S19.8 13 18.3 13H17"/></svg>',s.header[6]='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M4 12h8m-8 6V6m8 12V6"/><circle cx="19" cy="16" r="2"/><path d="M20 10c-2 2-3 3.5-3 6"/></g></svg>';const r={h1:"标题1",h2:"标题2",h3:"标题3",h4:"标题4",h5:"标题5",h6:"标题6",blockquote:"引用",codeblock:"代码块",code:"行内代码",link:"链接",image:"图片",video:"视频",formula:"公式",list:"列表",listBullet:"无序列表",listOrdered:"有序列表",listCheck:"任务列表"},l=[...new Array(6).fill(0).map(((e,n)=>({type:"item",name:`h${n+1}`,alias:["header",`head${n+1}`],icon:s.header[n+1],title:r[`h${n+1}`],onClick(e,i){e&&this.formatLine(e.index,e.index,"header",n+1,t.sources.USER)}}))),{type:"item",name:"bq",alias:["blockquote"],icon:s.blockquote,title:r.blockquote,descriptions:"插入引用格式",onClick(e,n){e&&this.formatLine(e.index,e.index,"blockquote",!0,t.sources.USER)}},{type:"item",name:"cb",alias:["code","codeblock"],icon:s["code-block"],title:r.codeblock,onClick(e,n){e&&this.formatLine(e.index,e.index,"code-block",!0,t.sources.USER)}},{type:"item",name:"lk",alias:["link"],icon:s.link,title:r.link,onClick(e,n){if(!e)return;const i=prompt("Enter link title");if(!i)return;const o=prompt("Enter link URL");o&&(this.insertText(e.index,i,t.sources.USER),this.formatText(e.index,e.length+i.length,"link",o,t.sources.USER),this.setSelection({index:e.index,length:e.index+i.length}))}},{type:"item",name:"img",alias:["image","pic","picture"],icon:s.image,title:r.image,onClick(e,n){if(!e)return;const i=prompt("Enter image");i&&this.insertEmbed(e.index,"image",i,t.sources.USER)}},{type:"item",name:"vd",alias:["video"],icon:s.video,title:r.video,onClick(e,n){if(!e)return;const i=prompt("Enter video");i&&this.insertEmbed(e.index,"video",i,t.sources.USER)}},{type:"item",name:"fm",alias:["formula"],icon:s.formula,title:r.formula,onClick(e,n){if(!e)return;const i=prompt("Enter formula");i&&this.insertEmbed(e.index,"formula",i,t.sources.USER)}},{type:"group",name:"list",alias:[],hideSearch:!0,icon:s.list.bullet,title:r.list,children:[{type:"item",name:"bl",alias:["list","bullet"],icon:s.list.bullet,title:r.listBullet,onClick(e,n){e&&this.formatLine(e.index,e.length,"list","bullet",t.sources.USER)}},{type:"item",name:"od",alias:["list","ordered"],icon:s.list.ordered,title:r.listOrdered,onClick(e,n){e&&this.formatLine(e.index,e.length,"list","ordered",t.sources.USER)}},{type:"item",name:"ck",alias:["list","check"],icon:s.list.check,title:r.listCheck,onClick(e,n){e&&this.formatLine(e.index,e.length,"list","unchecked",t.sources.USER)}}]}],a={clean:{key:"/",shortKey:!0,handler(e){this.quill.removeFormat(e.index,e.length,t.sources.USER)}},...(e=>{const n=Object.keys(e),i={};for(const o of n){const[n,s]=o.split(" "),r=void 0===s;i[o]={handler(e,i){this.quill.format(n,r?!i.format[n]:s,t.sources.USER)},...e[o]}}return i})({strike:{key:"d",shortKey:!0},"align ":{key:"l",altKey:!0},"align center":{key:"c",altKey:!0},"align right":{key:"r",altKey:!0},"align justify":{key:"j",altKey:!0},"indent +1":{key:"]",shortKey:!0},"indent -1":{key:"[",shortKey:!0},"script sub":{key:";",shortKey:!0},"script super":{key:"'",shortKey:!0},code:{key:"e",shortKey:!0},"direction rtl":{key:"r",shortKey:!0},"direction ":{key:"l",shortKey:!0}})};function c(e,t){const n=e.toLowerCase(),i=t.toLowerCase();return n===i?2:i.includes(n)?1:0}function d(e,t){const n=e.map((e=>{let n=c(t,e.name);if(e.alias)for(const i of e.alias)n=Math.max(n,c(t,i));return{item:e,score:n}})).filter((({score:e})=>e>=.5));return n.sort(((e,t)=>t.score-e.score)),n.map((({item:e})=>e))}const u=t.import("parchment");class h{quill;bem=n("qsf","menu");options;menuSorter;currentMenu;menuContainer;menuKeyboardControlsCleanup;constructor(e,n){this.quill=e,this.options=this.resolveOptions(n),this.currentMenu=this.options.menuItems,this.menuSorter=d.bind(this,this.getAllMenuItems()),this.placeholderDisplay(),this.quill.on(t.events.COMPOSITION_START,(()=>{this.placeholderDisplay()})),this.quill.on(t.events.EDITOR_CHANGE,(e=>{if(e===t.events.SELECTION_CHANGE){this.placeholderDisplay();const e=this.quill.getSelection();if(e){const[t,n]=this.quill.getLine(e.index);if(t){const i=e.index-n,o=i+t.length(),s=this.quill.getText(i,o),r=this.quill.getFormat(i,o),l=Object.keys(r).some((e=>this.quill.scroll.registry.query(e,u.Scope.BLOCK_BLOT)));if(s.startsWith("/")&&!l){const e=s.match(/^\/(.+)/);if(e){const t=this.menuSorter(e[1]);this.currentMenu=t}else this.currentMenu=this.options.menuItems;return void this.generateMenuList(t,r)}}}this.destroyMenuList()}}))}resolveOptions(e){return Object.assign({placeholder:"Input / recall menu",menuItems:[],menuKeyboardControls:()=>!1},e)}getAllMenuItems(){const e=[];for(const t of this.options.menuItems)t.hideSearch||e.push(t),"group"===t.type&&e.push(...t.children.filter((e=>!e.hideSearch)));return e}placeholderDisplay(){const e=Array.from(this.quill.root.querySelectorAll(":scope > p[data-placeholder]"));for(const t of e)delete t.dataset.placeholder;const t=this.quill.getSelection(!0);if(t&&0===t.length){const[e]=this.quill.getLine(t.index);e&&1===e.length()&&(e.domNode.dataset.placeholder=this.options.placeholder)}}generateMenuItem(e,t){return{type:"item",children:(t.children||[]).map((t=>this.generateMenuItem(e,t))),content:()=>{if(t.content)return t.content();{const e=document.createElement("div");if(e.classList.add(this.bem.be("item-container")),t.icon){const n=document.createElement("div");n.classList.add(this.bem.be("item-icon"));const i=document.createElement("div");i.classList.add(this.bem.be("icon")),i.innerHTML=t.icon,n.appendChild(i),e.appendChild(n)}const n=document.createElement("div");n.classList.add(this.bem.be("item-content"));const i=document.createElement("div");i.classList.add(this.bem.be("item-title"));const o=document.createElement("span");if(o.textContent=t.title,i.appendChild(o),"item"===t.type){const e=document.createElement("span");e.classList.add(this.bem.be("item-hint")),e.textContent=`/${t.name}`,i.appendChild(e)}if(n.appendChild(i),t.descriptions){const e=document.createElement("div");e.classList.add(this.bem.be("item-descriptions")),e.textContent=t.descriptions,n.appendChild(e)}return e.appendChild(n),e}},onClose:e=>{t.onCloseSub&&t.onCloseSub.call(this.quill,e)},onOpen:e=>{t.onOpenSub&&t.onOpenSub.call(this.quill,e)},onClick:n=>{if("item"===t.type&&(e.domNode.innerHTML="",this.destroyMenuList()),t.onClick){const e=this.quill.getSelection();t.onClick.call(this.quill,e,n)}}}}generateMenuList(e,t){const n=o(this.currentMenu.map((t=>this.generateMenuItem(e,t))));this.menuKeyboardControlsCleanup&&this.menuKeyboardControlsCleanup(),this.menuKeyboardControlsCleanup=this.setupMenuKeyboardControls({wrapper:n,target:this.quill.root,menuControl:this.options.menuKeyboardControls}),this.menuContainer?this.menuContainer.innerHTML="":(this.menuContainer=document.createElement("div"),this.menuContainer.classList.add(this.bem.be("container")),this.quill.root.addEventListener("click",this.destroyMenuList),this.quill.container.appendChild(this.menuContainer));const i=this.quill.root.getBoundingClientRect(),s=e.domNode.getBoundingClientRect(),r=s.left-i.left+("right"===t.align?s.width:0),l=s.bottom-i.top;Object.assign(this.menuContainer.style,{left:`${r}px`,top:`${l}px`}),this.menuContainer.appendChild(n),requestAnimationFrame((()=>{if(!this.menuContainer)return;const e=this.menuContainer.getBoundingClientRect();window.innerWidth<e.right&&(this.menuContainer.style.left=r-e.width+"px"),window.innerHeight<e.bottom&&(this.menuContainer.style.top=l-s.height-e.height+"px")}))}destroyMenuList=()=>{this.quill.root.removeEventListener("click",this.destroyMenuList),this.menuKeyboardControlsCleanup&&this.menuKeyboardControlsCleanup(),this.menuContainer&&(this.menuContainer.remove(),this.menuContainer=void 0)};setupMenuKeyboardControls({wrapper:e,target:t,menuControl:n}){let i=e,o=null,s=-1;const r=e=>{const t=Array.from(i.querySelectorAll(`.${this.bem.be("item")}`));for(const[n,o]of t.entries())if(n===e){o.classList.add(this.bem.is("selected"));const e=i.getBoundingClientRect(),t=o.getBoundingClientRect(),n=t.bottom>e.bottom,s=t.top<e.top;n?i.scrollTop=o.offsetTop-i.clientHeight+t.height:s&&(i.scrollTop=o.offsetTop)}else o.classList.remove(this.bem.is("selected"));s=e},l=function(e,t){let n=null,i=[],o=null,s=0;return function(...r){const l=Date.now(),a=t-(l-s);i=r,o=this,a<=0||a>t?(n&&(clearTimeout(n),n=null),s=l,e.apply(o,i)):n||(n=setTimeout((()=>{s=Date.now(),n=null,e.apply(o,i)}),a))}}((e=>{const t=i.querySelectorAll(`:scope > .${this.bem.be("item")}`);if(0===t.length)return void("Enter"===e.key&&(e.preventDefault(),this.destroyMenuList()));if(!n(e,{currentMenu:i,selectedIndex:s}))switch(e.key){case"ArrowUp":e.preventDefault(),-1===s&&(s=0),r((s-1+t.length)%t.length);break;case"ArrowDown":e.preventDefault(),r((s+1)%t.length);break;case"ArrowRight":{e.preventDefault();const n=t[s];if(!n)return;if("true"===n.dataset.hasChildren){n.click();const e=n.querySelector(`.${this.bem.b()}`);e&&(o=i,i=e,r(0))}break}case"ArrowLeft":if(e.preventDefault(),o){const e=Number.parseInt(i.dataset.parent||"0",10);i=o,o=null,s=e,r(s);const t=Array.from(i.querySelectorAll(`.${this.bem.be("item")}`))[s];if(!t)return;t.dispatchEvent(new MouseEvent("mouseleave"))}break;case"Enter":{e.preventDefault();const n=t[Math.max(0,s)];if(n&&(n.click(),"true"===n.dataset.hasChildren)){const e=n.querySelector(`.${this.bem.b()}`);e&&(o=i,i=e,r(0))}break}}}),100);return t.addEventListener("keydown",l,!0),()=>{t.removeEventListener("keydown",l,!0)}}}e.QuillShortcutKey=h,e.default=h,e.defaultMenuItems=l,e.defaultShortKey=a,e.generateTableUpShortKeyMenu=function(e){const n=e({row:8,col:8,customBtn:!1}),i=()=>{const{row:e,col:t}=n.dataset;for(const e of Array.from(n.querySelectorAll(".active")))e.classList.remove("active");if(!e||!t)return;const i=Array.from(n.querySelectorAll(".table-up-select-box__item"));for(let n=0;n<i.length;n++){const{row:o,col:s}=i[n].dataset;if(o>e&&s>t)return;o<=e&&s<=t?i[n].classList.add("active"):i[n].classList.remove("active")}};return{tableUpKeyboardControl:(e,{currentMenu:t})=>{if(!t.contains(n))return!1;let o=Number(n.dataset.row),s=Number(n.dataset.col);switch(e.key){case"ArrowUp":o-=1;break;case"ArrowDown":o+=1;break;case"ArrowRight":s+=1;break;case"ArrowLeft":s-=1;break;default:return!1}return!(o<=0||s<=0)&&(o=Math.min(o,8),s=Math.min(s,8),n.dataset.row=String(o),n.dataset.col=String(s),i(),!0)},tableUpConfig:{type:"group",name:"table",alias:[],title:"表格",icon:t.import("ui/icons").table,onOpenSub(e){const t=e.item.querySelector(".qsf-menu");t&&(t.style.width="auto"),n.dataset.row="1",n.dataset.col="1",i()},children:[{type:"item",name:"table",alias:[],hideSearch:!0,content:()=>n,onClick(){const{row:e,col:t}=n.dataset;if(!e||!t)return;this.getModule("table-up").insertTable(Number(e),Number(t))}}]}}},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=dev.js.map
