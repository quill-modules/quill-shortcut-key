!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("quill")):"function"==typeof define&&define.amd?define(["exports","quill"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).bundle={},e.Quill)}(this,(function(e,t){"use strict";const n=(e,t)=>{const n=`${e}-`;return{b:()=>`${n}${t}`,be:e=>e?`${n}${t}__${e}`:"",bm:e=>e?`${n}${t}--${e}`:"",bem:(e,i)=>e&&i?`${n}${t}__${e}--${i}`:"",ns:e=>e?`${n}${e}`:"",bs:e=>e?`${n}${t}-${e}`:"",cv:e=>e?`--${n}${e}`:"",is:e=>`is-${e}`}};const i=n("qsf","menu"),s=e=>{const t=document.createElement("div");t.classList.add(i.b());for(const[n,o]of e.entries()){const{type:e,classes:l=[]}=o,r=document.createElement("div");if(r.classList.add(i.be("item"),...l),r.dataset.index=n.toString(),"break"===e)r.classList.add(i.is("break"));else{if("item"!==e)continue;{const{icon:e,text:t,content:l,children:a=[],onHover:d,onClick:c}=o;if(!e&&!t&&!l)continue;if(l)r.appendChild(l());else{if(e){const t=document.createElement("span");t.classList.add(i.be("icon")),t.innerHTML=e,r.appendChild(t)}if(t){const e=document.createElement("span");e.textContent=t,r.appendChild(e)}}if(a.length>0){r.dataset.hasChildren="true";const e=document.createElement("span");e.classList.add(i.be("icon"),i.is("arrow")),e.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"></path></svg>',r.appendChild(e);const t=s(a);let o;t.classList.add(i.is("transparent"));const l=()=>{t.remove()},d=()=>{if(r.contains(t))return;o&&(clearTimeout(o),o=void 0),r.classList.add(i.is("active")),t.dataset.parent=n.toString(),t.removeEventListener("transitionend",l);const e=r.getBoundingClientRect();Object.assign(t.style,{position:"fixed",width:`${e.width}px`,top:`${e.top}px`,left:`${e.right}px`}),r.appendChild(t),requestAnimationFrame((()=>{t.classList.remove(i.is("transparent"));const n=t.getBoundingClientRect();n.right>window.innerWidth&&Object.assign(t.style,{left:e.left-n.width+"px"}),n.bottom>window.innerHeight&&Object.assign(t.style,{top:e.bottom-n.height+"px"})}))},c=()=>{o&&(clearTimeout(o),o=void 0),r.classList.add(i.is("active")),o=setTimeout((()=>{t.addEventListener("transitionend",l,{once:!0}),t.classList.add(i.is("transparent"))}),150)};r.addEventListener("click",d);for(const e of[r,t])e.addEventListener("mouseenter",d),e.addEventListener("mouseleave",c)}d&&r.addEventListener("mouseenter",(()=>d(o,n))),c&&r.addEventListener("click",(()=>c(o,n)))}}t.appendChild(r)}return t},o=(e,t)=>{let n=e,s=null,o=-1;const l=e=>{const t=Array.from(n.querySelectorAll(`.${i.be("item")}`));for(const[s,o]of t.entries())if(s===e){o.classList.add(i.is("selected"));const e=n.getBoundingClientRect(),t=o.getBoundingClientRect(),s=t.bottom>e.bottom,l=t.top<e.top;s?n.scrollTop=o.offsetTop-n.clientHeight+t.height:l&&(n.scrollTop=o.offsetTop)}else o.classList.remove(i.is("selected"));o=e},r=function(e,t){let n=null,i=[],s=null,o=0;return function(...l){const r=Date.now(),a=t-(r-o);i=l,s=this,a<=0||a>t?(n&&(clearTimeout(n),n=null),o=r,e.apply(s,i)):n||(n=setTimeout((()=>{o=Date.now(),n=null,e.apply(s,i)}),a))}}((e=>{const t=n.querySelectorAll(`.${i.be("item")}`);if(0!==t.length)switch(e.key){case"ArrowUp":e.preventDefault(),-1===o&&(o=0),l((o-1+t.length)%t.length);break;case"ArrowDown":e.preventDefault(),l((o+1)%t.length);break;case"ArrowRight":{e.preventDefault();const r=t[o];if(!r)return;if("true"===r.dataset.hasChildren){r.click();const e=r.querySelector(`.${i.b()}`);e&&(s=n,n=e,l(0))}break}case"ArrowLeft":if(e.preventDefault(),s){const e=Number.parseInt(n.dataset.parent||"0",10);n.remove(),n=s,s=null,o=e,l(o)}break;case"Enter":{e.preventDefault();const n=t[o];n&&n.click();break}}}),100);return t.addEventListener("keydown",r,!0),()=>{t.removeEventListener("keydown",r,!0)}},l=t.import("ui/icons");l.header[1]='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h8m-8 6V6m8 12V6m5 6l3-2v8"/></svg>',l.header[2]='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h8m-8 6V6m8 12V6m9 12h-4c0-4 4-3 4-6c0-1.5-2-2.5-4-1"/></svg>',l.header[3]='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h8m-8 6V6m8 12V6m5.5 4.5c1.7-1 3.5 0 3.5 1.5a2 2 0 0 1-2 2m-2 3.5c2 1.5 4 .3 4-1.5a2 2 0 0 0-2-2"/></svg>',l.header[4]='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18V6m5 4v3a1 1 0 0 0 1 1h3m0-4v8M4 12h8m-8 6V6"/></svg>',l.header[5]='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h8m-8 6V6m8 12V6m5 7v-3h4m-4 7.7c.4.2.8.3 1.3.3c1.5 0 2.7-1.1 2.7-2.5S19.8 13 18.3 13H17"/></svg>',l.header[6]='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M4 12h8m-8 6V6m8 12V6"/><circle cx="19" cy="16" r="2"/><path d="M20 10c-2 2-3 3.5-3 6"/></g></svg>',console.log(l);const r={h1:"标题1",h2:"标题2",h3:"标题3",h4:"标题4",h5:"标题5",h6:"标题6",blockquote:"引用",codeblock:"代码块",code:"行内代码",link:"链接",image:"图片",video:"视频",formula:"公式",list:"列表",listBullet:"无序列表",listOrdered:"有序列表",listCheck:"任务列表"},a=(e,t)=>{if(!e)return;const n=e.controls.find((e=>e[0]===t));n&&n[1].click()},d=[...new Array(6).fill(0).map(((e,n)=>({type:"item",name:`h${n+1}`,alias:["header",`head${n+1}`],icon:l.header[n+1],title:r[`h${n+1}`],handler(e,i){i&&this.formatLine(i.index,i.index,"header",n+1,t.sources.USER)}}))),{type:"item",name:"bq",alias:["blockquote"],icon:l.blockquote,title:r.blockquote,descriptions:"插入引用格式",handler(e,n){n&&this.formatLine(n.index,n.index,"blockquote",!0,t.sources.USER)}},{type:"item",name:"cb",alias:["code","codeblock"],icon:l["code-block"],title:r.codeblock,handler(e,n){n&&this.formatLine(n.index,n.index,"code-block",!0,t.sources.USER)}},{type:"item",name:"lk",alias:["link"],icon:l.link,title:r.link,handler(e,n){if(!n)return;const i=this.getModule("toolbar");i&&(this.insertText(n.index,"link",t.sources.USER),this.setSelection({index:n.index,length:n.index+4}),a(i,"link"))}},{type:"item",name:"img",alias:["image","pic","picture"],icon:l.image,title:r.image,handler(e,t){t&&a(this.getModule("toolbar"),"image")}},{type:"item",name:"vd",alias:["video"],icon:l.video,title:r.video,handler(e,t){t&&a(this.getModule("toolbar"),"video")}},{type:"item",name:"fm",alias:["formula"],icon:l.formula,title:r.formula,handler(e,t){t&&a(this.getModule("toolbar"),"formula")}},{type:"group",icon:l.list.bullet,title:r.list,children:[{type:"item",name:"bl",alias:["list","bullet"],icon:l.list.bullet,title:r.listBullet,handler(e,n){n&&this.formatLine(n.index,n.length,"list","bullet",t.sources.USER)}},{type:"item",name:"od",alias:["list","ordered"],icon:l.list.ordered,title:r.listOrdered,handler(e,n){n&&this.formatLine(n.index,n.length,"list","ordered",t.sources.USER)}},{type:"item",name:"ck",alias:["list","check"],icon:l.list.check,title:r.listCheck,handler(e,n){n&&this.formatLine(n.index,n.length,"list","unchecked",t.sources.USER)}}]}],c={clean:{key:"/",shortKey:!0,handler(e){console.log(e),this.quill.removeFormat(e.index,e.length,t.sources.USER)}},...(e=>{const n=Object.keys(e),i={};for(const s of n){const[n,o]=s.split(" "),l=void 0===o;i[s]={handler(e,i){this.quill.format(n,l?!i.format[n]:o,t.sources.USER)},...e[s]}}return i})({strike:{key:"d",shortKey:!0},"align ":{key:"l",altKey:!0},"align center":{key:"c",altKey:!0},"align right":{key:"r",altKey:!0},"align justify":{key:"j",altKey:!0},"indent +1":{key:"]",shortKey:!0},"indent -1":{key:"[",shortKey:!0},"script sub":{key:".",shortKey:!0},"script super":{key:",",shortKey:!0},code:{key:"e",shortKey:!0},"direction rtl":{key:"r",shortKey:!0},"direction ":{key:"l",shortKey:!0}})};class h{index=new Map;items=[];SCORE_THRESHOLD=20;constructor(e){this.items=e,this.buildIndex()}buildIndex(){for(const e of this.items){this.addToIndex(e.name.toLowerCase(),e);for(const t of e.alias)this.addToIndex(t.toLowerCase(),e)}}addToIndex(e,t){this.addTermToIndex(e,t);for(let n=0;n<e.length-1;n++)for(let i=n+2;i<=Math.min(e.length,n+5);i++)this.addTermToIndex(e.slice(n,i),t)}addTermToIndex(e,t){this.index.has(e)||this.index.set(e,new Set),this.index.get(e).add(t)}getQuickSimilarity(e,t){const n=new Map;for(const t of e)n.set(t,(n.get(t)||0)+1);let i=0;for(const e of t){const t=n.get(e);t&&t>0&&(i++,n.set(e,t-1))}return 2*i/(e.length+t.length)*50}search(e){e=e.toLowerCase();const t=new Map,n=new Set,i=this.index.get(e)||new Set;for(const e of i)t.set(e,100),n.add(e);for(const i of this.items){if(n.has(i))continue;const s=[i.name.toLowerCase(),...i.alias.map((e=>e.toLowerCase()))];let o=0;for(const t of s)t.includes(e)?o=Math.max(o,80):e.includes(t)&&(o=Math.max(o,60));o>0&&(t.set(i,o),n.add(i))}if(e.length>1)for(const i of this.items)if(!n.has(i)){const n=[i.name.toLowerCase(),...i.alias.map((e=>e.toLowerCase()))],s=Math.max(...n.map((t=>this.getQuickSimilarity(e,t))));s>=this.SCORE_THRESHOLD&&t.set(i,s)}return console.log(t),[...t.entries()].filter((([e,t])=>t>=this.SCORE_THRESHOLD)).sort(((e,t)=>t[1]-e[1])).map((([e])=>e))}}const u=t.import("parchment");class m{quill;bem=n("qsf","menu");options;menuSorter;currentMenu;menuContainer;menuKeyboardControlsCleanup;constructor(e,n){this.quill=e,this.options=this.resolveOptions(n),this.currentMenu=this.options.menuItems,this.menuSorter=this.createMenuItemsSorter(this.options.menuItems),this.placeholderDisplay(),this.quill.on(t.events.COMPOSITION_START,(()=>{this.placeholderDisplay()})),this.quill.on(t.events.EDITOR_CHANGE,(e=>{e===t.events.SELECTION_CHANGE&&this.placeholderDisplay()})),this.quill.on(t.events.TEXT_CHANGE,(()=>{const e=this.quill.getSelection();if(e){const[t,n]=this.quill.getLine(e.index);if(t){const i=e.index-n,s=i+t.length(),o=this.quill.getText(i,s),l=this.quill.getFormat(i,s),r=Object.keys(l).some((e=>this.quill.scroll.registry.query(e,u.Scope.BLOCK_BLOT)));if(o.startsWith("/")&&!r){const e=o.match(/^\/(.+)/);if(e){const t=this.menuSorter(e[1]);this.currentMenu=t}else this.currentMenu=this.options.menuItems;return void this.generateMenuList(t,l)}}}this.destroyMenuList()}))}resolveOptions(e){const t=Object.assign({placeholder:"Input / recall menu",menuItems:[]},e);return t.menuItems=t.menuItems.map((e=>(e.type||(e.type="item"),e))),t}placeholderDisplay(){const e=Array.from(this.quill.root.querySelectorAll(":scope > p[data-placeholder]"));for(const t of e)delete t.dataset.placeholder;const t=this.quill.getSelection(!0);if(t&&0===t.length){const[e]=this.quill.getLine(t.index);e&&1===e.length()&&(e.domNode.dataset.placeholder=this.options.placeholder)}}createMenuItemsSorter(e){const t=[];for(const n of e)"group"===n.type?t.push(...n.children):t.push(n);const n=new h(t);return e=>n.search(e)}generateMenuItem(e,t){return{type:"item",children:(t.children||[]).map((t=>this.generateMenuItem(e,t))),content:()=>{const e=document.createElement("div");if(e.classList.add(this.bem.be("item-container")),t.icon){const n=document.createElement("div");n.classList.add(this.bem.be("item-icon"));const i=document.createElement("div");i.classList.add(this.bem.be("icon")),i.innerHTML=t.icon,n.appendChild(i),e.appendChild(n)}const n=document.createElement("div");n.classList.add(this.bem.be("item-content"));const i=document.createElement("div");i.classList.add(this.bem.be("item-title"));const s=document.createElement("span");if(s.textContent=t.title,i.appendChild(s),"item"===t.type){const e=document.createElement("span");e.classList.add(this.bem.be("item-hint")),e.textContent=`/${t.name}`,i.appendChild(e)}if(n.appendChild(i),t.descriptions){const e=document.createElement("div");e.classList.add(this.bem.be("item-descriptions")),e.textContent=t.descriptions,n.appendChild(e)}return e.appendChild(n),e},onClick:()=>{if("item"===t.type){e.domNode.innerHTML="";const n=this.quill.getSelection();t.handler.call(this.quill,t,n),this.destroyMenuList()}}}}generateMenuList(e,t){const n=s(this.currentMenu.map((t=>this.generateMenuItem(e,t))));this.menuKeyboardControlsCleanup=o(n,this.quill.root),this.menuContainer?this.menuContainer.innerHTML="":(this.menuContainer=document.createElement("div"),this.menuContainer.classList.add(this.bem.be("container")),this.quill.root.addEventListener("click",this.destroyMenuList),this.quill.container.appendChild(this.menuContainer));const i=this.quill.root.getBoundingClientRect(),l=e.domNode.getBoundingClientRect(),r=l.left-i.left+("right"===t.align?l.width:0),a=l.bottom-i.top;Object.assign(this.menuContainer.style,{left:`${r}px`,top:`${a}px`}),this.menuContainer.appendChild(n),requestAnimationFrame((()=>{if(!this.menuContainer)return;const e=this.menuContainer.getBoundingClientRect();window.innerWidth<e.right&&(this.menuContainer.style.left=r-e.width+"px"),window.innerHeight<e.bottom&&(this.menuContainer.style.top=a-l.height-e.height+"px")}))}destroyMenuList=()=>{this.quill.root.removeEventListener("click",this.destroyMenuList),this.menuKeyboardControlsCleanup&&this.menuKeyboardControlsCleanup(),this.menuContainer&&(this.menuContainer.remove(),this.menuContainer=void 0)}}e.QuillQuickInsert=m,e.default=m,e.defaultMenuItems=d,e.defaultShortKey=c,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=dev.js.map
