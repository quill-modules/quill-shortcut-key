!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("quill")):"function"==typeof define&&define.amd?define(["exports","quill"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).bundle={},e.Quill)}(this,(function(e,t){"use strict";const n=(e,t)=>{const n=`${e}-`;return{b:()=>`${n}${t}`,be:e=>e?`${n}${t}__${e}`:"",bm:e=>e?`${n}${t}--${e}`:"",bem:(e,s)=>e&&s?`${n}${t}__${e}--${s}`:"",ns:e=>e?`${n}${e}`:"",bs:e=>e?`${n}${t}-${e}`:"",cv:e=>e?`--${n}${e}`:"",is:e=>`is-${e}`}},s=e=>{const t=n("qsf","menu"),i=document.createElement("div");i.classList.add(t.b());for(const[n,o]of e.entries()){const{type:e,classes:d=[]}=o,a=document.createElement("div");if(a.classList.add(t.be("item-container"),...d),"break"===e)a.classList.add(t.is("break"));else{if("item"!==e)continue;{const{icon:e,text:i,content:d,children:r=[],onHover:l,onClick:c}=o;if(!e&&!i&&!d)continue;if(d)a.appendChild(d());else{if(e){const n=document.createElement("span");n.classList.add(t.be("icon")),n.innerHTML=e,a.appendChild(n)}if(i){const e=document.createElement("span");e.textContent=i,a.appendChild(e)}}if(r.length>0){const e=document.createElement("span");e.classList.add(t.be("icon"),t.is("arrow")),e.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"></path></svg>',a.appendChild(e);const n=s(r);let i;n.classList.add(t.is("transparent"));const o=()=>{n.remove()};for(const e of[a,n])e.addEventListener("mouseenter",(()=>{i&&(clearTimeout(i),i=void 0),a.classList.add(t.is("active")),n.removeEventListener("transitionend",o);const e=a.getBoundingClientRect();Object.assign(n.style,{position:"fixed",width:`${e.width}px`,top:`${e.top}px`,left:`${e.right}px`}),document.body.contains(n)||document.body.appendChild(n),requestAnimationFrame((()=>{n.classList.remove(t.is("transparent"));const s=n.getBoundingClientRect();s.right>window.innerWidth&&Object.assign(n.style,{left:e.left-s.width+"px"}),s.bottom>window.innerHeight&&Object.assign(n.style,{top:e.bottom-s.height+"px"})}))})),e.addEventListener("mouseleave",(()=>{i&&(clearTimeout(i),i=void 0),a.classList.remove(t.is("active")),i=setTimeout((()=>{n.addEventListener("transitionend",o,{once:!0}),n.classList.add(t.is("transparent"))}),150)}))}l&&a.addEventListener("mouseenter",(()=>l(o,n))),c&&a.addEventListener("click",(()=>c(o,n)))}}i.appendChild(a)}return i},i=t.import("ui/icons");i.header[1]='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h8m-8 6V6m8 12V6m5 6l3-2v8"/></svg>',i.header[2]='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h8m-8 6V6m8 12V6m9 12h-4c0-4 4-3 4-6c0-1.5-2-2.5-4-1"/></svg>',i.header[3]='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h8m-8 6V6m8 12V6m5.5 4.5c1.7-1 3.5 0 3.5 1.5a2 2 0 0 1-2 2m-2 3.5c2 1.5 4 .3 4-1.5a2 2 0 0 0-2-2"/></svg>',i.header[4]='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18V6m5 4v3a1 1 0 0 0 1 1h3m0-4v8M4 12h8m-8 6V6"/></svg>',i.header[5]='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h8m-8 6V6m8 12V6m5 7v-3h4m-4 7.7c.4.2.8.3 1.3.3c1.5 0 2.7-1.1 2.7-2.5S19.8 13 18.3 13H17"/></svg>',i.header[6]='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g class="ql-stroke" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M4 12h8m-8 6V6m8 12V6"/><circle cx="19" cy="16" r="2"/><path d="M20 10c-2 2-3 3.5-3 6"/></g></svg>',console.log(i);const o={h1:"标题1",h2:"标题2",h3:"标题3",h4:"标题4",h5:"标题5",h6:"标题6",blockquote:"引用"},d=[...new Array(6).fill(0).map(((e,n)=>({name:`h${n+1}`,alias:["header",`head${n+1}`],icon:i.header[n+1],title:o[`h${n+1}`],handler(){const e=this.getSelection();e&&this.formatLine(e.index,e.index,"header",n+1,t.sources.USER)}}))),{name:"yy",alias:["blockquote","bq"],icon:i.blockquote,title:o.blockquote,descriptions:"插入引用格式",handler(){const e=this.getSelection();e&&this.formatLine(e.index,e.index,"blockquote",!0,t.sources.USER)}}];class a{index=new Map;items=[];SCORE_THRESHOLD=20;constructor(e){this.items=e,this.buildIndex()}buildIndex(){for(const e of this.items){this.addToIndex(e.name.toLowerCase(),e);for(const t of e.alias)this.addToIndex(t.toLowerCase(),e)}}addToIndex(e,t){this.addTermToIndex(e,t);for(let n=0;n<e.length-1;n++)for(let s=n+2;s<=Math.min(e.length,n+5);s++)this.addTermToIndex(e.slice(n,s),t)}addTermToIndex(e,t){this.index.has(e)||this.index.set(e,new Set),this.index.get(e).add(t)}getQuickSimilarity(e,t){const n=new Map;for(const t of e)n.set(t,(n.get(t)||0)+1);let s=0;for(const e of t){const t=n.get(e);t&&t>0&&(s++,n.set(e,t-1))}return 2*s/(e.length+t.length)*50}search(e){e=e.toLowerCase();const t=new Map,n=new Set,s=this.index.get(e)||new Set;for(const e of s)t.set(e,100),n.add(e);for(const s of this.items){if(n.has(s))continue;const i=[s.name.toLowerCase(),...s.alias.map((e=>e.toLowerCase()))];let o=0;for(const t of i)t.includes(e)?o=Math.max(o,80):e.includes(t)&&(o=Math.max(o,60));o>0&&(t.set(s,o),n.add(s))}if(e.length>1)for(const s of this.items)if(!n.has(s)){const n=[s.name.toLowerCase(),...s.alias.map((e=>e.toLowerCase()))],i=Math.max(...n.map((t=>this.getQuickSimilarity(e,t))));i>=this.SCORE_THRESHOLD&&t.set(s,i)}return console.log(t),[...t.entries()].filter((([e,t])=>t>=this.SCORE_THRESHOLD)).sort(((e,t)=>t[1]-e[1])).map((([e])=>e))}}class r{quill;bem=n("qsf","menu");options;menuSorter;menuContainer;constructor(e,n){this.quill=e,this.options=this.resolveOptions(n),this.menuSorter=this.createMenuItemsSorter(this.options.menuItems),this.quill.on(t.events.EDITOR_CHANGE,(()=>{const e=this.quill.getSelection();if(e){const[t,n]=this.quill.getLine(e.index);if(t){const s=this.quill.getText(e.index-n,e.index-n+t.length()),i=s.match(/^\/(.+)/);if(s.startsWith("/")&&i){const e=this.menuSorter(i[1]);return void this.generateMenuList(e,t)}}}this.destroyMenuList()}))}resolveOptions(e){return Object.assign({menuItems:[]},e)}createMenuItemsSorter(e){const t=new a(e);return e=>t.search(e)}generateMenuList(e,t){const n=s(e.map((e=>({type:"item",content:()=>{const t=document.createElement("div");t.classList.add(this.bem.be("item"));const n=document.createElement("div");n.classList.add(this.bem.be("item-icon"));const s=document.createElement("div");s.classList.add(this.bem.be("icon")),s.innerHTML=e.icon,n.appendChild(s);const i=document.createElement("div");i.classList.add(this.bem.be("item-content"));const o=document.createElement("div");o.classList.add(this.bem.be("item-title"));const d=document.createElement("span");d.textContent=e.title;const a=document.createElement("span");if(a.classList.add(this.bem.be("item-hint")),a.textContent=`/${e.name}`,o.appendChild(d),o.appendChild(a),i.appendChild(o),e.descriptions){const t=document.createElement("div");t.classList.add(this.bem.be("item-descriptions")),t.textContent=e.descriptions,i.appendChild(t)}return t.appendChild(n),t.appendChild(i),t},onClick:()=>{t.domNode.innerHTML="",e.handler.call(this.quill,e.name),this.destroyMenuList()}}))));this.menuContainer?this.menuContainer.innerHTML="":(this.menuContainer=document.createElement("div"),this.menuContainer.classList.add(this.bem.be("container")),document.body.appendChild(this.menuContainer));const i=t.domNode.getBoundingClientRect();Object.assign(this.menuContainer.style,{left:`${i.left}px`,top:`${i.bottom}px`}),this.menuContainer.appendChild(n)}destroyMenuList(){this.menuContainer&&(this.menuContainer.remove(),this.menuContainer=void 0)}}e.QuillQuickInsert=r,e.default=r,e.defaultMenuItems=d,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=dev.js.map
